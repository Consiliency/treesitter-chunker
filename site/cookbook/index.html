
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Tree-sitter Chunker Cookbook - Tree-sitter Chunker</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tree-sitter-chunker-cookbook" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Tree-sitter Chunker" class="md-header__button md-logo" aria-label="Tree-sitter Chunker" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Tree-sitter Chunker
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Tree-sitter Chunker Cookbook
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Consiliency/treesitter-chunker" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Overview

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../getting-started/" class="md-tabs__link">
        
  
  
    
  
  Getting Started

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../user-guide/" class="md-tabs__link">
        
  
  
    
  
  User Guide

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../configuration/" class="md-tabs__link">
        
  
  
    
  
  Configuration

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../cli-reference/" class="md-tabs__link">
        
  
  
    
  
  CLI Reference

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../api-reference/" class="md-tabs__link">
        
  
  
    
  
  API Reference

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../export-formats/" class="md-tabs__link">
        
  
  
    
  
  Export Formats

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../graphml_export/" class="md-tabs__link">
        
  
  
    
  
  GraphML Export

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../performance-guide/" class="md-tabs__link">
        
  
  
    
  
  Performance Guide

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../grammar_discovery/" class="md-tabs__link">
        
  
  
    
  
  Grammar Discovery

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../zero_config_api/" class="md-tabs__link">
        
  
  
    
  
  Zero-Config API

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Tree-sitter Chunker" class="md-nav__button md-logo" aria-label="Tree-sitter Chunker" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Tree-sitter Chunker
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Consiliency/treesitter-chunker" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../user-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CLI Reference
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../export-formats/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Export Formats
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../graphml_export/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GraphML Export
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../performance-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Performance Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../grammar_discovery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Grammar Discovery
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../zero_config_api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Zero-Config API
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      Table of Contents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code-search-and-indexing" class="md-nav__link">
    <span class="md-ellipsis">
      Code Search and Indexing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Code Search and Indexing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#build-a-function-search-engine" class="md-nav__link">
    <span class="md-ellipsis">
      Build a Function Search Engine
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-symbol-navigator" class="md-nav__link">
    <span class="md-ellipsis">
      Create a Symbol Navigator
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#documentation-generation" class="md-nav__link">
    <span class="md-ellipsis">
      Documentation Generation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Documentation Generation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generate-api-documentation-with-type-hints" class="md-nav__link">
    <span class="md-ellipsis">
      Generate API Documentation with Type Hints
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-readme-from-code-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Generate README from Code Structure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code-quality-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Code Quality Analysis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Code Quality Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#complexity-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Complexity Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-duplication-detection" class="md-nav__link">
    <span class="md-ellipsis">
      Code Duplication Detection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#plugin-development-recipes" class="md-nav__link">
    <span class="md-ellipsis">
      Plugin Development Recipes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Plugin Development Recipes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-custom-language-plugin" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a Custom Language Plugin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plugin-with-custom-chunk-rules" class="md-nav__link">
    <span class="md-ellipsis">
      Plugin with Custom Chunk Rules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#export-format-recipes" class="md-nav__link">
    <span class="md-ellipsis">
      Export Format Recipes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Export Format Recipes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#multi-format-export-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Multi-Format Export Pipeline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-export-format-for-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Export Format for Documentation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aiml-integration" class="md-nav__link">
    <span class="md-ellipsis">
      AI/ML Integration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AI/ML Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generate-code-embeddings-for-semantic-search" class="md-nav__link">
    <span class="md-ellipsis">
      Generate Code Embeddings for Semantic Search
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-training-data-for-code-models" class="md-nav__link">
    <span class="md-ellipsis">
      Generate Training Data for Code Models
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Performance Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-new-parallel-processing-apis" class="md-nav__link">
    <span class="md-ellipsis">
      Using New Parallel Processing APIs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#streaming-processing-for-huge-files" class="md-nav__link">
    <span class="md-ellipsis">
      Streaming Processing for Huge Files
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-recipes" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration Recipes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration Recipes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dynamic-configuration-based-on-project-type" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic Configuration Based on Project Type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parallel-processing-with-progress-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      Parallel Processing with Progress Tracking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#incremental-processing-with-change-detection" class="md-nav__link">
    <span class="md-ellipsis">
      Incremental Processing with Change Detection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#language-specific-recipes" class="md-nav__link">
    <span class="md-ellipsis">
      Language-Specific Recipes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Language-Specific Recipes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python-extract-type-hints-and-decorators" class="md-nav__link">
    <span class="md-ellipsis">
      Python: Extract Type Hints and Decorators
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#javascripttypescript-extract-exports-and-imports" class="md-nav__link">
    <span class="md-ellipsis">
      JavaScript/TypeScript: Extract Exports and Imports
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rust-analyze-traits-and-implementations" class="md-nav__link">
    <span class="md-ellipsis">
      Rust: Analyze Traits and Implementations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-tool-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Build Tool Integration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Build Tool Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pre-commit-hook" class="md-nav__link">
    <span class="md-ellipsis">
      Pre-commit Hook
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#github-actions-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      GitHub Actions Workflow
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#custom-chunk-types" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Chunk Types
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-also" class="md-nav__link">
    <span class="md-ellipsis">
      See Also
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="tree-sitter-chunker-cookbook">Tree-sitter Chunker Cookbook<a class="headerlink" href="#tree-sitter-chunker-cookbook" title="Permanent link">&para;</a></h1>
<p>This cookbook contains practical recipes for common use cases with Tree-sitter Chunker. Each recipe is self-contained and can be adapted to your specific needs.</p>
<h2 id="table-of-contents">Table of Contents<a class="headerlink" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#code-search-and-indexing">Code Search and Indexing</a></li>
<li><a href="#documentation-generation">Documentation Generation</a></li>
<li><a href="#code-quality-analysis">Code Quality Analysis</a></li>
<li><a href="#aiml-integration">AI/ML Integration</a></li>
<li><a href="#plugin-development-recipes">Plugin Development Recipes</a></li>
<li><a href="#export-format-recipes">Export Format Recipes</a></li>
<li><a href="#performance-optimization">Performance Optimization</a></li>
<li><a href="#configuration-recipes">Configuration Recipes</a></li>
<li><a href="#language-specific-recipes">Language-Specific Recipes</a></li>
<li><a href="#build-tool-integration">Build Tool Integration</a></li>
<li><a href="#advanced-patterns">Advanced Patterns</a></li>
</ol>
<h2 id="code-search-and-indexing">Code Search and Indexing<a class="headerlink" href="#code-search-and-indexing" title="Permanent link">&para;</a></h2>
<h3 id="build-a-function-search-engine">Build a Function Search Engine<a class="headerlink" href="#build-a-function-search-engine" title="Permanent link">&para;</a></h3>
<p>Create a fast, searchable database of all functions in your codebase.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chunker.chunker</span><span class="w"> </span><span class="kn">import</span> <span class="n">chunk_file</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chunker.parser</span><span class="w"> </span><span class="kn">import</span> <span class="n">list_languages</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chunker.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">LanguageNotFoundError</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CodeSearchEngine</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A SQLite-based searchable index of code chunks.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_path</span><span class="o">=</span><span class="s2">&quot;code_index.db&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_tables</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create database schema.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">executescript</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            CREATE TABLE IF NOT EXISTS chunks (</span>
<span class="s1">                id INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="s1">                file_path TEXT NOT NULL,</span>
<span class="s1">                language TEXT NOT NULL,</span>
<span class="s1">                node_type TEXT NOT NULL,</span>
<span class="s1">                name TEXT,</span>
<span class="s1">                start_line INTEGER,</span>
<span class="s1">                end_line INTEGER,</span>
<span class="s1">                parent_context TEXT,</span>
<span class="s1">                content TEXT,</span>
<span class="s1">                signature TEXT,</span>
<span class="s1">                indexed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP</span>
<span class="s1">            );</span>

<span class="s1">            CREATE INDEX IF NOT EXISTS idx_name ON chunks(name);</span>
<span class="s1">            CREATE INDEX IF NOT EXISTS idx_type ON chunks(node_type);</span>
<span class="s1">            CREATE INDEX IF NOT EXISTS idx_file ON chunks(file_path);</span>
<span class="s1">            CREATE INDEX IF NOT EXISTS idx_parent ON chunks(parent_context);</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">index_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Index all supported files in a directory.&quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="n">language_extensions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;.py&#39;</span><span class="p">:</span> <span class="s1">&#39;python&#39;</span><span class="p">,</span>
            <span class="s1">&#39;.js&#39;</span><span class="p">:</span> <span class="s1">&#39;javascript&#39;</span><span class="p">,</span>
            <span class="s1">&#39;.rs&#39;</span><span class="p">:</span> <span class="s1">&#39;rust&#39;</span><span class="p">,</span>
            <span class="s1">&#39;.c&#39;</span><span class="p">:</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span>
            <span class="s1">&#39;.cpp&#39;</span><span class="p">:</span> <span class="s1">&#39;cpp&#39;</span><span class="p">,</span>
            <span class="s1">&#39;.cc&#39;</span><span class="p">:</span> <span class="s1">&#39;cpp&#39;</span><span class="p">,</span>
            <span class="s1">&#39;.h&#39;</span><span class="p">:</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span>
            <span class="s1">&#39;.hpp&#39;</span><span class="p">:</span> <span class="s1">&#39;cpp&#39;</span>
        <span class="p">}</span>

        <span class="n">indexed_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ext</span><span class="p">,</span> <span class="n">language</span> <span class="ow">in</span> <span class="n">language_extensions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;*</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_skip</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
                    <span class="k">continue</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">chunks</span> <span class="o">=</span> <span class="n">chunk_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">),</span> <span class="n">language</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_index_chunk</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
                        <span class="n">indexed_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error indexing </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Indexed </span><span class="si">{</span><span class="n">indexed_count</span><span class="si">}</span><span class="s2"> code chunks&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">indexed_count</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_should_skip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if file should be skipped.&quot;&quot;&quot;</span>
        <span class="n">skip_dirs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;__pycache__&#39;</span><span class="p">,</span> <span class="s1">&#39;node_modules&#39;</span><span class="p">,</span> <span class="s1">&#39;.git&#39;</span><span class="p">,</span> <span class="s1">&#39;venv&#39;</span><span class="p">,</span> <span class="s1">&#39;.venv&#39;</span><span class="p">}</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">part</span> <span class="ow">in</span> <span class="n">skip_dirs</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">file_path</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_index_chunk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Index a single chunk.&quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_name</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
        <span class="n">signature</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            INSERT INTO chunks </span>
<span class="s1">            (file_path, language, node_type, name, start_line, </span>
<span class="s1">             end_line, parent_context, content, signature)</span>
<span class="s1">            VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">,</span> <span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">),</span>
            <span class="n">chunk</span><span class="o">.</span><span class="n">language</span><span class="p">,</span>
            <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span><span class="p">,</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span><span class="p">,</span>
            <span class="n">chunk</span><span class="o">.</span><span class="n">end_line</span><span class="p">,</span>
            <span class="n">chunk</span><span class="o">.</span><span class="n">parent_context</span><span class="p">,</span>
            <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
            <span class="n">signature</span>
        <span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract function/class name from chunk.&quot;&quot;&quot;</span>
        <span class="n">patterns</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;python&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;(?:def|class)\s+(\w+)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;javascript&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;(?:function|class|const|let|var)\s+(\w+)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;rust&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;(?:fn|struct|impl|trait)\s+(\w+)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;(?:\w+\s+)?(\w+)\s*\(&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cpp&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;(?:class|struct|(?:\w+\s+)?(\w+)\s*\()&#39;</span>
        <span class="p">}</span>

        <span class="n">pattern</span> <span class="o">=</span> <span class="n">patterns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;(\w+)&#39;</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">match</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Search for chunks by name or content.&quot;&quot;&quot;</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT * FROM chunks</span>
<span class="s1">            WHERE name LIKE ? OR content LIKE ?</span>
<span class="s1">            ORDER BY </span>
<span class="s1">                CASE </span>
<span class="s1">                    WHEN name = ? THEN 0</span>
<span class="s1">                    WHEN name LIKE ? THEN 1</span>
<span class="s1">                    ELSE 2</span>
<span class="s1">                END,</span>
<span class="s1">                name</span>
<span class="s1">            LIMIT ?</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">,</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;%</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;%</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">,</span>
            <span class="n">query</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">,</span>
            <span class="n">limit</span>
        <span class="p">))</span>

        <span class="k">return</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_by_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find all chunks of a specific type.&quot;&quot;&quot;</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s1">&#39;SELECT * FROM chunks WHERE node_type = ? ORDER BY file_path, start_line&#39;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">node_type</span><span class="p">,)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_in_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find all chunks in a specific file.&quot;&quot;&quot;</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s1">&#39;SELECT * FROM chunks WHERE file_path = ? ORDER BY start_line&#39;</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">),)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get index statistics.&quot;&quot;&quot;</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Total chunks</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT COUNT(*) as count FROM chunks&#39;</span><span class="p">)</span>
        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;total_chunks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>

        <span class="c1"># By language</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT language, COUNT(*) as count </span>
<span class="s1">            FROM chunks </span>
<span class="s1">            GROUP BY language</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;by_language&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;language&#39;</span><span class="p">]:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">}</span>

        <span class="c1"># By type</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT node_type, COUNT(*) as count </span>
<span class="s1">            FROM chunks </span>
<span class="s1">            GROUP BY node_type</span>
<span class="s1">            ORDER BY count DESC</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;by_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;node_type&#39;</span><span class="p">]:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">}</span>

        <span class="k">return</span> <span class="n">stats</span>

<span class="c1"># Usage example</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># Create search engine</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="n">CodeSearchEngine</span><span class="p">()</span>

    <span class="c1"># Index your project</span>
    <span class="n">engine</span><span class="o">.</span><span class="n">index_directory</span><span class="p">(</span><span class="s2">&quot;./src&quot;</span><span class="p">)</span>

    <span class="c1"># Search for functions</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;process&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[:</span><span class="mi">5</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;file_path&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;start_line&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;signature&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Get statistics</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">get_statistics</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Total chunks: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;total_chunks&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;By language:&quot;</span><span class="p">,</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;by_language&#39;</span><span class="p">])</span>
</code></pre></div>

<h3 id="create-a-symbol-navigator">Create a Symbol Navigator<a class="headerlink" href="#create-a-symbol-navigator" title="Permanent link">&para;</a></h3>
<p>Build an interactive symbol navigator for your codebase.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">chunker.chunker</span><span class="w"> </span><span class="kn">import</span> <span class="n">chunk_file</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SymbolNavigator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Navigate code symbols hierarchically.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_dir</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">root_dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbol_tree</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_tree</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">build_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build hierarchical symbol tree.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">py_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*.py&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;__pycache__&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">py_file</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">chunks</span> <span class="o">=</span> <span class="n">chunk_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">py_file</span><span class="p">),</span> <span class="s2">&quot;python&quot;</span><span class="p">)</span>
                <span class="n">rel_path</span> <span class="o">=</span> <span class="n">py_file</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span><span class="p">)</span>

                <span class="n">file_symbols</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">rel_path</span><span class="p">),</span>
                    <span class="s1">&#39;classes&#39;</span><span class="p">:</span> <span class="p">{},</span>
                    <span class="s1">&#39;functions&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s1">&#39;total_lines&#39;</span><span class="p">:</span> <span class="mi">0</span>
                <span class="p">}</span>

                <span class="c1"># First pass: collect classes</span>
                <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span> <span class="o">==</span> <span class="s2">&quot;class_definition&quot;</span><span class="p">:</span>
                        <span class="n">class_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_name</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                        <span class="n">file_symbols</span><span class="p">[</span><span class="s1">&#39;classes&#39;</span><span class="p">][</span><span class="n">class_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span><span class="p">,</span>
                            <span class="s1">&#39;end_line&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">end_line</span><span class="p">,</span>
                            <span class="s1">&#39;methods&#39;</span><span class="p">:</span> <span class="p">[],</span>
                            <span class="s1">&#39;docstring&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_docstring</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                        <span class="p">}</span>

                <span class="c1"># Second pass: collect methods and functions</span>
                <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span> <span class="o">==</span> <span class="s2">&quot;function_definition&quot;</span><span class="p">:</span>
                        <span class="n">func_info</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_name</span><span class="p">(</span><span class="n">chunk</span><span class="p">),</span>
                            <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span><span class="p">,</span>
                            <span class="s1">&#39;end_line&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">end_line</span><span class="p">,</span>
                            <span class="s1">&#39;is_async&#39;</span><span class="p">:</span> <span class="s1">&#39;async def&#39;</span> <span class="ow">in</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="s1">&#39;decorators&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_decorators</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                        <span class="p">}</span>

                        <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">parent_context</span><span class="p">:</span>
                            <span class="c1"># It&#39;s a method</span>
                            <span class="n">class_name</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">parent_context</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">class_name</span> <span class="ow">in</span> <span class="n">file_symbols</span><span class="p">[</span><span class="s1">&#39;classes&#39;</span><span class="p">]:</span>
                                <span class="n">file_symbols</span><span class="p">[</span><span class="s1">&#39;classes&#39;</span><span class="p">][</span><span class="n">class_name</span><span class="p">][</span><span class="s1">&#39;methods&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func_info</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># It&#39;s a standalone function</span>
                            <span class="n">file_symbols</span><span class="p">[</span><span class="s1">&#39;functions&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func_info</span><span class="p">)</span>

                <span class="c1"># Calculate total lines</span>
                <span class="k">if</span> <span class="n">chunks</span><span class="p">:</span>
                    <span class="n">file_symbols</span><span class="p">[</span><span class="s1">&#39;total_lines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">end_line</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">symbol_tree</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">rel_path</span><span class="p">)]</span> <span class="o">=</span> <span class="n">file_symbols</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing </span><span class="si">{</span><span class="n">py_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract name from chunk.&quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?:def|class)\s+(\w+)&#39;</span><span class="p">,</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">match</span> <span class="k">else</span> <span class="s2">&quot;unknown&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_docstring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract first line of docstring.&quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]):</span>
            <span class="k">if</span> <span class="s1">&#39;&quot;&quot;&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">or</span> <span class="s2">&quot;&#39;&#39;&#39;&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;&#39;&#39;&#39;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_decorators</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract decorator names.&quot;&quot;&quot;</span>
        <span class="n">decorators</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">):</span>
                <span class="n">decorator</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">decorators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">decorator</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;def &#39;</span><span class="p">):</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">decorators</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">print_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print symbol tree in a nice format.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">symbols</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbol_tree</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;total_lines&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> lines)&quot;</span><span class="p">)</span>

            <span class="c1"># Print classes</span>
            <span class="k">for</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">class_info</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;classes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s2"> (line </span><span class="si">{</span><span class="n">class_info</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">class_info</span><span class="p">[</span><span class="s1">&#39;docstring&#39;</span><span class="p">]:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      </span><span class="si">{</span><span class="n">class_info</span><span class="p">[</span><span class="s1">&#39;docstring&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">class_info</span><span class="p">[</span><span class="s1">&#39;methods&#39;</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]):</span>
                    <span class="n">icon</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">method</span><span class="p">[</span><span class="s1">&#39;is_async&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">icon</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">method</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (line </span><span class="si">{</span><span class="n">method</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">method</span><span class="p">[</span><span class="s1">&#39;decorators&#39;</span><span class="p">]:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;         </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">method</span><span class="p">[</span><span class="s1">&#39;decorators&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Print standalone functions</span>
            <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;functions&#39;</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]):</span>
                <span class="n">icon</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">func</span><span class="p">[</span><span class="s1">&#39;is_async&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">icon</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">func</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (line </span><span class="si">{</span><span class="n">func</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">func</span><span class="p">[</span><span class="s1">&#39;decorators&#39;</span><span class="p">]:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;       </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">func</span><span class="p">[</span><span class="s1">&#39;decorators&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">export_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_file</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Export symbol tree as JSON.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbol_tree</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbol_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find all occurrences of a symbol.&quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">symbols</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol_tree</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Check classes</span>
            <span class="k">if</span> <span class="n">symbol_name</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;classes&#39;</span><span class="p">]:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span>
                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;class&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;classes&#39;</span><span class="p">][</span><span class="n">symbol_name</span><span class="p">][</span><span class="s1">&#39;line&#39;</span><span class="p">]</span>
                <span class="p">})</span>

            <span class="c1"># Check methods</span>
            <span class="k">for</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">class_info</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;classes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">class_info</span><span class="p">[</span><span class="s1">&#39;methods&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">method</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">symbol_name</span><span class="p">:</span>
                        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span>
                            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;method&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="n">class_name</span><span class="p">,</span>
                            <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="n">method</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span>
                        <span class="p">})</span>

            <span class="c1"># Check functions</span>
            <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;functions&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">func</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">symbol_name</span><span class="p">:</span>
                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span>
                        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;function&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="n">func</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span>
                    <span class="p">})</span>

        <span class="k">return</span> <span class="n">results</span>

<span class="c1"># Usage</span>
<span class="n">navigator</span> <span class="o">=</span> <span class="n">SymbolNavigator</span><span class="p">(</span><span class="s2">&quot;./src&quot;</span><span class="p">)</span>
<span class="n">navigator</span><span class="o">.</span><span class="n">print_tree</span><span class="p">()</span>

<span class="c1"># Find specific symbol</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">navigator</span><span class="o">.</span><span class="n">find_symbol</span><span class="p">(</span><span class="s2">&quot;__init__&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> occurrences of &#39;__init__&#39;:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="documentation-generation">Documentation Generation<a class="headerlink" href="#documentation-generation" title="Permanent link">&para;</a></h2>
<h3 id="generate-api-documentation-with-type-hints">Generate API Documentation with Type Hints<a class="headerlink" href="#generate-api-documentation-with-type-hints" title="Permanent link">&para;</a></h3>
<p>Extract comprehensive API documentation including type hints and examples.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">ast</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chunker.chunker</span><span class="w"> </span><span class="kn">import</span> <span class="n">chunk_file</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

<span class="k">class</span><span class="w"> </span><span class="nc">APIDocGenerator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate rich API documentation from Python code.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process a Python file and extract API documentation.&quot;&quot;&quot;</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="n">chunk_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;python&quot;</span><span class="p">)</span>
        <span class="n">file_docs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;function_definition&quot;</span><span class="p">,</span> <span class="s2">&quot;class_definition&quot;</span><span class="p">]:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_documentation</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">doc</span><span class="p">:</span>
                        <span class="n">file_docs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span><span class="si">}</span><span class="s2"> at line </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">file_docs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_documentation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract comprehensive documentation from a chunk.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="n">node</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">doc</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span><span class="p">,</span>
                <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span>
                <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span><span class="p">,</span>
                <span class="s1">&#39;end_line&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">end_line</span><span class="p">,</span>
                <span class="s1">&#39;parent&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">parent_context</span><span class="p">,</span>
                <span class="s1">&#39;docstring&#39;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">get_docstring</span><span class="p">(</span><span class="n">node</span><span class="p">),</span>
                <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">FunctionDef</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">AsyncFunctionDef</span><span class="p">):</span>
                <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_extract_function_details</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">ClassDef</span><span class="p">):</span>
                <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_extract_class_details</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">chunk</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">doc</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_function_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract function-specific details.&quot;&quot;&quot;</span>
        <span class="n">details</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;is_async&#39;</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">AsyncFunctionDef</span><span class="p">),</span>
            <span class="s1">&#39;decorators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_decorator_name</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">decorator_list</span><span class="p">],</span>
            <span class="s1">&#39;parameters&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_parameters</span><span class="p">(</span><span class="n">node</span><span class="p">),</span>
            <span class="s1">&#39;returns&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_return_type</span><span class="p">(</span><span class="n">node</span><span class="p">),</span>
            <span class="s1">&#39;raises&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_raises</span><span class="p">(</span><span class="n">node</span><span class="p">),</span>
            <span class="s1">&#39;yields&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_yields</span><span class="p">(</span><span class="n">node</span><span class="p">),</span>
            <span class="s1">&#39;examples&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_examples</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">get_docstring</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">details</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_class_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">chunk</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract class-specific details.&quot;&quot;&quot;</span>
        <span class="n">details</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;bases&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">base</span><span class="p">)</span> <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">bases</span><span class="p">],</span>
            <span class="s1">&#39;decorators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_decorator_name</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">decorator_list</span><span class="p">],</span>
            <span class="s1">&#39;methods&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_methods</span><span class="p">(</span><span class="n">node</span><span class="p">),</span>
            <span class="s1">&#39;class_variables&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_class_variables</span><span class="p">(</span><span class="n">node</span><span class="p">),</span>
            <span class="s1">&#39;is_dataclass&#39;</span><span class="p">:</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_decorator_name</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;dataclass&#39;</span> 
                               <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">decorator_list</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">details</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_decorator_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decorator</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get decorator name as string.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">decorator</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">decorator</span><span class="o">.</span><span class="n">id</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">decorator</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">decorator</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">decorator</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">id</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">decorator</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func_node</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract function parameters with type hints.&quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">func_node</span><span class="o">.</span><span class="n">args</span>

        <span class="c1"># Regular arguments</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">args</span><span class="p">):</span>
            <span class="n">param</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">arg</span><span class="o">.</span><span class="n">arg</span><span class="p">,</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">annotation</span><span class="p">)</span> <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">annotation</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">None</span>
            <span class="p">}</span>

            <span class="c1"># Check for defaults</span>
            <span class="n">defaults_start</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">defaults</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">defaults_start</span><span class="p">:</span>
                <span class="n">default_index</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="n">defaults_start</span>
                <span class="n">param</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="n">default_index</span><span class="p">])</span>

            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>

        <span class="c1"># *args</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">vararg</span><span class="p">:</span>
            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;*</span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">vararg</span><span class="o">.</span><span class="n">arg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">vararg</span><span class="o">.</span><span class="n">annotation</span><span class="p">)</span> <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">vararg</span><span class="o">.</span><span class="n">annotation</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">None</span>
            <span class="p">})</span>

        <span class="c1"># **kwargs</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">kwarg</span><span class="p">:</span>
            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;**</span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">kwarg</span><span class="o">.</span><span class="n">arg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">kwarg</span><span class="o">.</span><span class="n">annotation</span><span class="p">)</span> <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">kwarg</span><span class="o">.</span><span class="n">annotation</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">None</span>
            <span class="p">})</span>

        <span class="k">return</span> <span class="n">params</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_return_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func_node</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract return type annotation.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">func_node</span><span class="o">.</span><span class="n">returns</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">func_node</span><span class="o">.</span><span class="n">returns</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_raises</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract exceptions that might be raised.&quot;&quot;&quot;</span>
        <span class="n">raises</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Raise</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">exc</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">exc</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">exc</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
                        <span class="n">raises</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">exc</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">exc</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
                        <span class="n">raises</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">exc</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">raises</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_yields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if function is a generator.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Yield</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">YieldFrom</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_examples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docstring</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract code examples from docstring.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">docstring</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">examples</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">in_example</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">current_example</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">docstring</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;&gt;&gt;&gt;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">in_example</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">current_example</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">in_example</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">):</span>
                <span class="c1"># End of example</span>
                <span class="k">if</span> <span class="n">current_example</span><span class="p">:</span>
                    <span class="n">examples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_example</span><span class="p">))</span>
                <span class="n">current_example</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">in_example</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">in_example</span><span class="p">:</span>
                <span class="n">current_example</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">current_example</span><span class="p">:</span>
            <span class="n">examples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_example</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">examples</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_count_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class_node</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Count methods in a class.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">class_node</span><span class="o">.</span><span class="n">body</span> 
                  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">FunctionDef</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">AsyncFunctionDef</span><span class="p">)))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_class_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class_node</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract class variables with type annotations.&quot;&quot;&quot;</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">class_node</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">AnnAssign</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
                <span class="n">variables</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">annotation</span><span class="p">),</span>
                    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="p">})</span>
        <span class="k">return</span> <span class="n">variables</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_markdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate comprehensive Markdown documentation.&quot;&quot;&quot;</span>
        <span class="n">md</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;# API Documentation</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">md</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;*Generated with Tree-sitter Chunker*</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Group by file</span>
        <span class="n">by_file</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">:</span>
            <span class="n">by_file</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">],</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>

        <span class="c1"># Generate table of contents</span>
        <span class="n">md</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;## Table of Contents</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">by_file</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
            <span class="n">md</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- [</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">](#</span><span class="si">{</span><span class="n">file_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="n">md</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Generate documentation for each file</span>
        <span class="k">for</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">file_docs</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">by_file</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
            <span class="n">md</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">md</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;*</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">*</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Sort by type (classes first) and line number</span>
            <span class="n">sorted_docs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">file_docs</span><span class="p">,</span> 
                               <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;class_definition&#39;</span> <span class="k">else</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]))</span>

            <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">sorted_docs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">doc</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;class_definition&#39;</span><span class="p">:</span>
                    <span class="n">md</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_class_doc</span><span class="p">(</span><span class="n">doc</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">md</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_function_doc</span><span class="p">(</span><span class="n">doc</span><span class="p">))</span>

        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">md</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_format_class_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format class documentation.&quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">### class `</span><span class="si">{</span><span class="n">doc</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">`</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bases&#39;</span><span class="p">):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;*Inherits from: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s1">&#39;bases&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">*</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decorators&#39;</span><span class="p">):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;**Decorators:** `</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s1">&#39;decorators&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">`</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;docstring&#39;</span><span class="p">):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s1">&#39;docstring&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;class_variables&#39;</span><span class="p">):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;**Class Variables:**&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">[</span><span class="s1">&#39;class_variables&#39;</span><span class="p">]:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- `</span><span class="si">{</span><span class="n">var</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">var</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">`&quot;</span> <span class="o">+</span> 
                           <span class="p">(</span><span class="sa">f</span><span class="s2">&quot; = `</span><span class="si">{</span><span class="n">var</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">`&quot;</span> <span class="k">if</span> <span class="n">var</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;**Methods:** </span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;methods&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">lines</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_format_function_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format function documentation.&quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parent&#39;</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">doc</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">### </span><span class="si">{</span><span class="s1">&#39;async &#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;is_async&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">function `</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">`</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decorators&#39;</span><span class="p">):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;**Decorators:** `</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s1">&#39;decorators&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">`</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Signature</span>
        <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parameters&#39;</span><span class="p">):</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">]:</span>
                <span class="n">param_str</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]:</span>
                    <span class="n">param_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]:</span>
                    <span class="n">param_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; = </span><span class="si">{</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param_str</span><span class="p">)</span>

            <span class="n">returns</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; -&gt; </span><span class="si">{</span><span class="n">doc</span><span class="p">[</span><span class="s1">&#39;returns&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;returns&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;```python</span><span class="se">\n</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span><span class="si">{</span><span class="n">returns</span><span class="si">}</span><span class="se">\n</span><span class="s2">```</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;docstring&#39;</span><span class="p">):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s1">&#39;docstring&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;raises&#39;</span><span class="p">):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;**Raises:** </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;`</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">`&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">doc</span><span class="p">[</span><span class="s1">&#39;raises&#39;</span><span class="p">])</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;yields&#39;</span><span class="p">):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;**Yields:** This is a generator function</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;examples&#39;</span><span class="p">):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;**Examples:**&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">example</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">[</span><span class="s1">&#39;examples&#39;</span><span class="p">]:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;```python&quot;</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">example</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;```&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">lines</span>

<span class="c1"># Usage</span>
<span class="n">generator</span> <span class="o">=</span> <span class="n">APIDocGenerator</span><span class="p">()</span>

<span class="c1"># Process a file or directory</span>
<span class="n">all_docs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">py_file</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;src&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*.py&quot;</span><span class="p">):</span>
    <span class="n">docs</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">process_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">py_file</span><span class="p">))</span>
    <span class="n">all_docs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>

<span class="c1"># Generate markdown</span>
<span class="n">markdown</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">generate_markdown</span><span class="p">(</span><span class="n">all_docs</span><span class="p">)</span>

<span class="c1"># Save documentation</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;API_DOCUMENTATION.md&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">markdown</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated documentation for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_docs</span><span class="p">)</span><span class="si">}</span><span class="s2"> items&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="generate-readme-from-code-structure">Generate README from Code Structure<a class="headerlink" href="#generate-readme-from-code-structure" title="Permanent link">&para;</a></h3>
<p>Automatically generate project documentation from your codebase.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">chunker.chunker</span><span class="w"> </span><span class="kn">import</span> <span class="n">chunk_file</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chunker.parser</span><span class="w"> </span><span class="kn">import</span> <span class="n">list_languages</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ReadmeGenerator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate README.md from code analysis.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">project_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate complete README.&quot;&quot;&quot;</span>
        <span class="n">sections</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Title and description</span>
        <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_header</span><span class="p">())</span>

        <span class="c1"># Project structure</span>
        <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_structure</span><span class="p">())</span>

        <span class="c1"># API overview</span>
        <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_api_overview</span><span class="p">())</span>

        <span class="c1"># Installation</span>
        <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_installation</span><span class="p">())</span>

        <span class="c1"># Usage examples</span>
        <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_usage_examples</span><span class="p">())</span>

        <span class="c1"># Contributing</span>
        <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_contributing</span><span class="p">())</span>

        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">sections</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate header section.&quot;&quot;&quot;</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;# </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>

        <span class="c1"># Try to extract description from main module</span>
        <span class="n">init_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span> <span class="o">/</span> <span class="s2">&quot;__init__.py&quot;</span>
        <span class="k">if</span> <span class="n">init_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">init_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">):</span>
                    <span class="n">docstring</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">docstring</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Add badges (placeholder)</span>
        <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">![Python](https://img.shields.io/badge/python-3.8+-blue.svg)&quot;</span><span class="p">)</span>
        <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;![License](https://img.shields.io/badge/license-MIT-green.svg)&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate project structure overview.&quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;## Project Structure</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>

        <span class="c1"># Find main modules</span>
        <span class="n">modules</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">py_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*.py&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;__pycache__&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">py_file</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">rel_path</span> <span class="o">=</span> <span class="n">py_file</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rel_path</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">,</span> <span class="s1">&#39;docs&#39;</span><span class="p">,</span> <span class="s1">&#39;examples&#39;</span><span class="p">]:</span>
                <span class="n">module_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">rel_path</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">module_path</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span>
                    <span class="n">module_path</span> <span class="o">=</span> <span class="s1">&#39;root&#39;</span>
                <span class="n">modules</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">module_path</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">py_file</span><span class="o">.</span><span class="n">stem</span><span class="p">)</span>

        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;```&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">module</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">modules</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">module</span> <span class="o">!=</span> <span class="s1">&#39;root&#39;</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">module</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">file</span> <span class="o">!=</span> <span class="s1">&#39;__init__&#39;</span><span class="p">:</span>
                        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">.py&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">file</span> <span class="o">!=</span> <span class="s1">&#39;__init__&#39;</span><span class="p">:</span>
                        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">.py&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;```&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_api_overview</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate API overview from code analysis.&quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;## API Overview</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>

        <span class="c1"># Analyze main modules</span>
        <span class="n">api_items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">py_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*.py&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">skip</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">py_file</span><span class="p">)</span> <span class="k">for</span> <span class="n">skip</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;__pycache__&#39;</span><span class="p">,</span> <span class="s1">&#39;tests&#39;</span><span class="p">,</span> <span class="s1">&#39;_test&#39;</span><span class="p">]):</span>
                <span class="k">continue</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">chunks</span> <span class="o">=</span> <span class="n">chunk_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">py_file</span><span class="p">),</span> <span class="s2">&quot;python&quot;</span><span class="p">)</span>
                <span class="n">module_name</span> <span class="o">=</span> <span class="n">py_file</span><span class="o">.</span><span class="n">stem</span>

                <span class="c1"># Find public classes and functions</span>
                <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;class_definition&quot;</span><span class="p">,</span> <span class="s2">&quot;function_definition&quot;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk</span><span class="o">.</span><span class="n">parent_context</span><span class="p">:</span>  <span class="c1"># Top-level only</span>
                            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_name</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">name</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
                                <span class="n">docstring</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_first_line_docstring</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                                <span class="n">api_items</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                                    <span class="s1">&#39;module&#39;</span><span class="p">:</span> <span class="n">module_name</span><span class="p">,</span>
                                    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;class&#39;</span> <span class="k">if</span> <span class="s1">&#39;class&#39;</span> <span class="ow">in</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span> <span class="k">else</span> <span class="s1">&#39;function&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;docstring&#39;</span><span class="p">:</span> <span class="n">docstring</span>
                                <span class="p">})</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">continue</span>

        <span class="c1"># Group by module</span>
        <span class="n">by_module</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">api_items</span><span class="p">:</span>
            <span class="n">by_module</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">],</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">module</span><span class="p">,</span> <span class="n">items</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">by_module</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">items</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;### </span><span class="si">{</span><span class="n">module</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])):</span>
                    <span class="n">icon</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;class&#39;</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                    <span class="n">desc</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; - </span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;docstring&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;docstring&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">icon</span><span class="si">}</span><span class="s2"> **</span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">**</span><span class="si">{</span><span class="n">desc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_installation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate installation instructions.&quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;## Installation</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>

        <span class="c1"># Check for setup.py or pyproject.toml</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span> <span class="o">/</span> <span class="s2">&quot;setup.py&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span> <span class="o">/</span> <span class="s2">&quot;pyproject.toml&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;```bash&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pip install </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;```&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">For development:&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;```bash&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;git clone https://github.com/yourusername/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="s2">.git&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cd </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;pip install -e .[dev]&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;```&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;```bash&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;git clone https://github.com/yourusername/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="s2">.git&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cd </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;pip install -r requirements.txt&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;```&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_usage_examples</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate usage examples from code.&quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;## Usage</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>

        <span class="c1"># Look for main entry points</span>
        <span class="n">main_funcs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">py_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*.py&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;__pycache__&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">py_file</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">chunks</span> <span class="o">=</span> <span class="n">chunk_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">py_file</span><span class="p">),</span> <span class="s2">&quot;python&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span> <span class="o">==</span> <span class="s2">&quot;function_definition&quot;</span><span class="p">:</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_name</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">,</span> <span class="s1">&#39;run&#39;</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">py_file</span><span class="o">.</span><span class="n">stem</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
                            <span class="n">main_funcs</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                                <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">py_file</span><span class="p">,</span>
                                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                                <span class="s1">&#39;chunk&#39;</span><span class="p">:</span> <span class="n">chunk</span>
                            <span class="p">})</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">continue</span>

        <span class="k">if</span> <span class="n">main_funcs</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;### Basic Usage</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;```python&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="s2"> import ...&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;```&quot;</span><span class="p">)</span>

        <span class="c1"># Look for example files</span>
        <span class="n">example_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;examples/*.py&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">example_files</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">### Examples</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">example</span> <span class="ow">in</span> <span class="n">example_files</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>  <span class="c1"># Show first 3</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;See `</span><span class="si">{</span><span class="n">example</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span><span class="si">}</span><span class="s2">` for a complete example.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_contributing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate contributing section.&quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;## Contributing</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Contributions are welcome! Please feel free to submit a Pull Request.&quot;</span><span class="p">)</span>

        <span class="c1"># Check for tests</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span> <span class="o">/</span> <span class="s2">&quot;tests&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">or</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;test_*.py&quot;</span><span class="p">)):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Please make sure to update tests as appropriate:&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;```bash&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;pytest&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;```&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract name from chunk.&quot;&quot;&quot;</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?:def|class)\s+(\w+)&#39;</span><span class="p">,</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">match</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_first_line_docstring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract first line of docstring.&quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]):</span>
            <span class="k">if</span> <span class="s1">&#39;&quot;&quot;&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">or</span> <span class="s2">&quot;&#39;&#39;&#39;&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="c1"># Extract just the first sentence</span>
                <span class="n">docstring</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;&#39;&#39;&#39;&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;. &#39;</span> <span class="ow">in</span> <span class="n">docstring</span><span class="p">:</span>
                    <span class="n">docstring</span> <span class="o">=</span> <span class="n">docstring</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;. &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span>
                <span class="k">return</span> <span class="n">docstring</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="c1"># Usage</span>
<span class="n">generator</span> <span class="o">=</span> <span class="n">ReadmeGenerator</span><span class="p">(</span><span class="s2">&quot;./my_project&quot;</span><span class="p">)</span>
<span class="n">readme_content</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;README_generated.md&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">readme_content</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;README.md generated successfully!&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="code-quality-analysis">Code Quality Analysis<a class="headerlink" href="#code-quality-analysis" title="Permanent link">&para;</a></h2>
<h3 id="complexity-analysis">Complexity Analysis<a class="headerlink" href="#complexity-analysis" title="Permanent link">&para;</a></h3>
<p>Analyze code complexity using various metrics.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">chunker.chunker</span><span class="w"> </span><span class="kn">import</span> <span class="n">chunk_file</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chunker.parser</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_parser</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ast</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">statistics</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ComplexityReport</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Code complexity metrics for a function.&quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">line</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">end_line</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># Cyclomatic complexity</span>
    <span class="n">cognitive_complexity</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">lines_of_code</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">max_nesting</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">parameter_count</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">return_points</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ComplexityAnalyzer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Comprehensive code complexity analyzer.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ComplexityReport</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyze all functions in a file.&quot;&quot;&quot;</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="n">chunk_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;python&quot;</span><span class="p">)</span>
        <span class="n">reports</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span> <span class="o">==</span> <span class="s2">&quot;function_definition&quot;</span><span class="p">:</span>
                <span class="n">report</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analyze_function</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">report</span><span class="p">:</span>
                    <span class="n">reports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">reports</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_analyze_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyze a single function.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="n">func</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">FunctionDef</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">AsyncFunctionDef</span><span class="p">)):</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="k">return</span> <span class="n">ComplexityReport</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">file</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span>
                <span class="n">line</span><span class="o">=</span><span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span><span class="p">,</span>
                <span class="n">end_line</span><span class="o">=</span><span class="n">chunk</span><span class="o">.</span><span class="n">end_line</span><span class="p">,</span>
                <span class="n">complexity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cyclomatic_complexity</span><span class="p">(</span><span class="n">func</span><span class="p">),</span>
                <span class="n">cognitive_complexity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cognitive_complexity</span><span class="p">(</span><span class="n">func</span><span class="p">),</span>
                <span class="n">lines_of_code</span><span class="o">=</span><span class="n">chunk</span><span class="o">.</span><span class="n">end_line</span> <span class="o">-</span> <span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">max_nesting</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_nesting_depth</span><span class="p">(</span><span class="n">func</span><span class="p">),</span>
                <span class="n">parameter_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
                <span class="n">return_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_count_returns</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error analyzing function at line </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_cyclomatic_complexity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate McCabe cyclomatic complexity.&quot;&quot;&quot;</span>
        <span class="n">complexity</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Base complexity</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="c1"># Decision points</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">If</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">While</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">For</span><span class="p">)):</span>
                <span class="n">complexity</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">ExceptHandler</span><span class="p">):</span>
                <span class="n">complexity</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># Boolean operators</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">BoolOp</span><span class="p">):</span>
                <span class="c1"># Each &#39;and&#39;/&#39;or&#39; adds a branch</span>
                <span class="n">complexity</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="c1"># Comprehensions</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">ListComp</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">SetComp</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">DictComp</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">GeneratorExp</span><span class="p">)):</span>
                <span class="n">complexity</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">generators</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">complexity</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_cognitive_complexity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">nesting</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate cognitive complexity (how hard to understand).&quot;&quot;&quot;</span>
        <span class="n">complexity</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">If</span><span class="p">):</span>
                <span class="c1"># If statements increase complexity, more with nesting</span>
                <span class="n">complexity</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">nesting</span>
                <span class="c1"># Check for else</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">orelse</span><span class="p">:</span>
                    <span class="n">complexity</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># Recurse</span>
                <span class="n">complexity</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cognitive_complexity</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">nesting</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">For</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">While</span><span class="p">)):</span>
                <span class="n">complexity</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">nesting</span>
                <span class="n">complexity</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cognitive_complexity</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">nesting</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Try</span><span class="p">):</span>
                <span class="n">complexity</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">nesting</span>
                <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
                    <span class="n">complexity</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">complexity</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cognitive_complexity</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">nesting</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">With</span><span class="p">):</span>
                <span class="n">complexity</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">nesting</span>
                <span class="n">complexity</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cognitive_complexity</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">nesting</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">):</span>
                <span class="n">complexity</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cognitive_complexity</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">nesting</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">complexity</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_max_nesting_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate maximum nesting depth.&quot;&quot;&quot;</span>
        <span class="n">max_depth</span> <span class="o">=</span> <span class="n">depth</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">iter_child_nodes</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">If</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">For</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">While</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">With</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Try</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">nested</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
                        <span class="n">child_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_nesting_depth</span><span class="p">(</span><span class="n">nested</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="n">max_depth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_depth</span><span class="p">,</span> <span class="n">child_depth</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">max_depth</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_count_returns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Count number of return statements.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> 
                  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Return</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Yield</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">YieldFrom</span><span class="p">)))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reports</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ComplexityReport</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a complexity report.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">reports</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No functions analyzed.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Code Complexity Report&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Function&#39;</span><span class="si">:</span><span class="s2">&lt;30</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;CC&#39;</span><span class="si">:</span><span class="s2">&lt;5</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Cog&#39;</span><span class="si">:</span><span class="s2">&lt;5</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;LOC&#39;</span><span class="si">:</span><span class="s2">&lt;5</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Nest&#39;</span><span class="si">:</span><span class="s2">&lt;5</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Params&#39;</span><span class="si">:</span><span class="s2">&lt;7</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Returns&#39;</span><span class="si">:</span><span class="s2">&lt;7</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Status&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>

        <span class="c1"># Sort by cyclomatic complexity</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">reports</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">complexity</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="c1"># Determine status</span>
            <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">complexity</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot; High&quot;</span>
            <span class="k">elif</span> <span class="n">r</span><span class="o">.</span><span class="n">complexity</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot; Medium&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot; Low&quot;</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">name</span><span class="si">:</span><span class="s2">&lt;30</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">complexity</span><span class="si">:</span><span class="s2">&lt;5</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">cognitive_complexity</span><span class="si">:</span><span class="s2">&lt;5</span><span class="si">}</span><span class="s2"> &quot;</span>
                  <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">lines_of_code</span><span class="si">:</span><span class="s2">&lt;5</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">max_nesting</span><span class="si">:</span><span class="s2">&lt;5</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">parameter_count</span><span class="si">:</span><span class="s2">&lt;7</span><span class="si">}</span><span class="s2"> &quot;</span>
                  <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">return_points</span><span class="si">:</span><span class="s2">&lt;7</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Summary statistics</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Summary Statistics:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total functions: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">reports</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Average cyclomatic complexity: </span><span class="si">{</span><span class="n">statistics</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">complexity</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">reports</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Average cognitive complexity: </span><span class="si">{</span><span class="n">statistics</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">cognitive_complexity</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">reports</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  High complexity functions (CC &gt; 10): </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">reports</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">r</span><span class="o">.</span><span class="n">complexity</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total lines of code: </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">lines_of_code</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">reports</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_complex_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reports</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ComplexityReport</span><span class="p">],</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find functions exceeding complexity threshold.&quot;&quot;&quot;</span>
        <span class="n">complex_funcs</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reports</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">complexity</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">complex_funcs</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Functions exceeding complexity threshold (</span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2">):&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">complex_funcs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">complexity</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">file</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">line</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (CC: </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">complexity</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Suggestions:&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">max_nesting</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Reduce nesting (current: </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">max_nesting</span><span class="si">}</span><span class="s2"> levels)&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">parameter_count</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Consider using configuration object (current: </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">parameter_count</span><span class="si">}</span><span class="s2"> params)&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">lines_of_code</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - Split into smaller functions (current: </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">lines_of_code</span><span class="si">}</span><span class="s2"> lines)&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">complex_funcs</span>

<span class="c1"># Usage</span>
<span class="n">analyzer</span> <span class="o">=</span> <span class="n">ComplexityAnalyzer</span><span class="p">()</span>

<span class="c1"># Analyze a single file</span>
<span class="n">reports</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">analyze_file</span><span class="p">(</span><span class="s2">&quot;complex_module.py&quot;</span><span class="p">)</span>
<span class="n">analyzer</span><span class="o">.</span><span class="n">generate_report</span><span class="p">(</span><span class="n">reports</span><span class="p">)</span>

<span class="c1"># Find overly complex functions</span>
<span class="n">complex_functions</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">find_complex_functions</span><span class="p">(</span><span class="n">reports</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Analyze entire project</span>
<span class="n">all_reports</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">py_file</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;src&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*.py&quot;</span><span class="p">):</span>
    <span class="n">reports</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">analyze_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">py_file</span><span class="p">))</span>
    <span class="n">all_reports</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">reports</span><span class="p">)</span>

<span class="n">analyzer</span><span class="o">.</span><span class="n">generate_report</span><span class="p">(</span><span class="n">all_reports</span><span class="p">)</span>
</code></pre></div>

<h3 id="code-duplication-detection">Code Duplication Detection<a class="headerlink" href="#code-duplication-detection" title="Permanent link">&para;</a></h3>
<p>Find duplicate or similar code blocks.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">chunker.chunker</span><span class="w"> </span><span class="kn">import</span> <span class="n">chunk_file</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">difflib</span><span class="w"> </span><span class="kn">import</span> <span class="n">SequenceMatcher</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DuplicationDetector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detect duplicate and similar code blocks.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">similarity_threshold</span><span class="o">=</span><span class="mf">0.85</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">similarity_threshold</span> <span class="o">=</span> <span class="n">similarity_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chunks_by_hash</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_chunks</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyze all Python files in directory.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">py_file</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*.py&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;__pycache__&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">py_file</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">chunks</span> <span class="o">=</span> <span class="n">chunk_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">py_file</span><span class="p">),</span> <span class="s2">&quot;python&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;function_definition&quot;</span><span class="p">,</span> <span class="s2">&quot;method_definition&quot;</span><span class="p">]:</span>
                        <span class="c1"># Normalize content for comparison</span>
                        <span class="n">normalized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_code</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
                        <span class="n">chunk_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">normalized</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">chunks_by_hash</span><span class="p">[</span><span class="n">chunk_hash</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">all_chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing </span><span class="si">{</span><span class="n">py_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_normalize_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Normalize code for comparison (remove comments, normalize whitespace).&quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">code</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="c1"># Remove comments</span>
            <span class="k">if</span> <span class="s1">&#39;#&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="n">line</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)]</span>
            <span class="c1"># Normalize whitespace</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_exact_duplicates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find exact duplicate functions.&quot;&quot;&quot;</span>
        <span class="n">duplicates</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">chunk_hash</span><span class="p">,</span> <span class="n">chunks</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunks_by_hash</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">duplicates</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;hash&#39;</span><span class="p">:</span> <span class="n">chunk_hash</span><span class="p">,</span>
                    <span class="s1">&#39;chunks&#39;</span><span class="p">:</span> <span class="n">chunks</span><span class="p">,</span>
                    <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>
                <span class="p">})</span>

        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">duplicates</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_similar_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find similar (but not identical) code blocks.&quot;&quot;&quot;</span>
        <span class="n">similar_groups</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">checked_pairs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chunk1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_chunks</span><span class="p">):</span>
            <span class="n">similar_chunks</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">chunk2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_chunks</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:],</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">pair_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pair_key</span> <span class="ow">in</span> <span class="n">checked_pairs</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="n">similarity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_similarity</span><span class="p">(</span><span class="n">chunk1</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">chunk2</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">similarity</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">similarity_threshold</span><span class="p">:</span>
                    <span class="n">similar_chunks</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;chunk&#39;</span><span class="p">:</span> <span class="n">chunk2</span><span class="p">,</span>
                        <span class="s1">&#39;similarity&#39;</span><span class="p">:</span> <span class="n">similarity</span>
                    <span class="p">})</span>
                    <span class="n">checked_pairs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pair_key</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">similar_chunks</span><span class="p">:</span>
                <span class="n">similar_groups</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;original&#39;</span><span class="p">:</span> <span class="n">chunk1</span><span class="p">,</span>
                    <span class="s1">&#39;similar&#39;</span><span class="p">:</span> <span class="n">similar_chunks</span>
                <span class="p">})</span>

        <span class="k">return</span> <span class="n">similar_groups</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code1</span><span class="p">,</span> <span class="n">code2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate similarity between two code blocks.&quot;&quot;&quot;</span>
        <span class="c1"># Normalize for comparison</span>
        <span class="n">norm1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_code</span><span class="p">(</span><span class="n">code1</span><span class="p">)</span>
        <span class="n">norm2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_code</span><span class="p">(</span><span class="n">code2</span><span class="p">)</span>

        <span class="c1"># Use sequence matcher for similarity</span>
        <span class="k">return</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">norm1</span><span class="p">,</span> <span class="n">norm2</span><span class="p">)</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate duplication report.&quot;&quot;&quot;</span>
        <span class="n">exact_duplicates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_exact_duplicates</span><span class="p">()</span>
        <span class="n">similar_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_similar_code</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Code Duplication Report&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>

        <span class="c1"># Exact duplicates</span>
        <span class="k">if</span> <span class="n">exact_duplicates</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Exact Duplicates Found: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">exact_duplicates</span><span class="p">)</span><span class="si">}</span><span class="s2"> groups&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">dup_group</span> <span class="ow">in</span> <span class="n">exact_duplicates</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Duplicate group (</span><span class="si">{</span><span class="n">dup_group</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> instances):&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">dup_group</span><span class="p">[</span><span class="s1">&#39;chunks&#39;</span><span class="p">]:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">file_path</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">end_line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># Show the duplicate code</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  Code:&quot;</span><span class="p">)</span>
                <span class="n">preview</span> <span class="o">=</span> <span class="n">dup_group</span><span class="p">[</span><span class="s1">&#39;chunks&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">preview</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dup_group</span><span class="p">[</span><span class="s1">&#39;chunks&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ...&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> No exact duplicates found&quot;</span><span class="p">)</span>

        <span class="c1"># Similar code</span>
        <span class="k">if</span> <span class="n">similar_code</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Similar Code Blocks: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">similar_code</span><span class="p">)</span><span class="si">}</span><span class="s2"> groups&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">similar_code</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>  <span class="c1"># Show top 10</span>
                <span class="n">orig</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;original&#39;</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Original: </span><span class="si">{</span><span class="n">orig</span><span class="o">.</span><span class="n">file_path</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">orig</span><span class="o">.</span><span class="n">start_line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">similar</span> <span class="ow">in</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;similar&#39;</span><span class="p">]:</span>
                    <span class="n">chunk</span> <span class="o">=</span> <span class="n">similar</span><span class="p">[</span><span class="s1">&#39;chunk&#39;</span><span class="p">]</span>
                    <span class="n">similarity</span> <span class="o">=</span> <span class="n">similar</span><span class="p">[</span><span class="s1">&#39;similarity&#39;</span><span class="p">]</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Similar (</span><span class="si">{</span><span class="n">similarity</span><span class="si">:</span><span class="s2">.0%</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">file_path</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Summary</span>
        <span class="n">total_chunks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_chunks</span><span class="p">)</span>
        <span class="n">duplicate_chunks</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="s1">&#39;chunks&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">exact_duplicates</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Summary:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total functions analyzed: </span><span class="si">{</span><span class="n">total_chunks</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Exact duplicate functions: </span><span class="si">{</span><span class="n">duplicate_chunks</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Duplication rate: </span><span class="si">{</span><span class="n">duplicate_chunks</span><span class="o">/</span><span class="n">total_chunks</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

        <span class="c1"># Calculate saved lines</span>
        <span class="n">saved_lines</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">dup_group</span> <span class="ow">in</span> <span class="n">exact_duplicates</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dup_group</span><span class="p">[</span><span class="s1">&#39;chunks&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">chunk</span> <span class="o">=</span> <span class="n">dup_group</span><span class="p">[</span><span class="s1">&#39;chunks&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">end_line</span> <span class="o">-</span> <span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">saved_lines</span> <span class="o">+=</span> <span class="n">lines</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dup_group</span><span class="p">[</span><span class="s1">&#39;chunks&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">saved_lines</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Potential lines saved by removing duplicates: </span><span class="si">{</span><span class="n">saved_lines</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">suggest_refactoring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">duplicates</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Suggest refactoring for duplicate code.&quot;&quot;&quot;</span>
        <span class="n">suggestions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">dup_group</span> <span class="ow">in</span> <span class="n">duplicates</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dup_group</span><span class="p">[</span><span class="s1">&#39;chunks&#39;</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="c1"># Multiple duplicates - suggest extracting to shared module</span>
                <span class="n">suggestions</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;extract_to_module&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;chunks&#39;</span><span class="p">:</span> <span class="n">dup_group</span><span class="p">[</span><span class="s1">&#39;chunks&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dup_group</span><span class="p">[</span><span class="s1">&#39;chunks&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> duplicate implementations found&quot;</span>
                <span class="p">})</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">dup_group</span><span class="p">[</span><span class="s1">&#39;chunks&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># Two duplicates - check if they&#39;re in related modules</span>
                <span class="n">chunk1</span><span class="p">,</span> <span class="n">chunk2</span> <span class="o">=</span> <span class="n">dup_group</span><span class="p">[</span><span class="s1">&#39;chunks&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">chunk1</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">==</span> <span class="n">Path</span><span class="p">(</span><span class="n">chunk2</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                    <span class="n">suggestions</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;extract_to_base&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;chunks&#39;</span><span class="p">:</span> <span class="n">dup_group</span><span class="p">[</span><span class="s1">&#39;chunks&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="s2">&quot;Duplicates in same module - consider extracting&quot;</span>
                    <span class="p">})</span>

        <span class="k">return</span> <span class="n">suggestions</span>

<span class="c1"># Usage</span>
<span class="n">detector</span> <span class="o">=</span> <span class="n">DuplicationDetector</span><span class="p">(</span><span class="n">similarity_threshold</span><span class="o">=</span><span class="mf">0.85</span><span class="p">)</span>

<span class="c1"># Analyze codebase</span>
<span class="n">detector</span><span class="o">.</span><span class="n">analyze_directory</span><span class="p">(</span><span class="s2">&quot;./src&quot;</span><span class="p">)</span>

<span class="c1"># Generate report</span>
<span class="n">detector</span><span class="o">.</span><span class="n">generate_report</span><span class="p">()</span>

<span class="c1"># Get suggestions</span>
<span class="n">duplicates</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">find_exact_duplicates</span><span class="p">()</span>
<span class="n">suggestions</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">suggest_refactoring</span><span class="p">(</span><span class="n">duplicates</span><span class="p">)</span>

<span class="k">if</span> <span class="n">suggestions</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Refactoring Suggestions:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">suggestion</span> <span class="ow">in</span> <span class="n">suggestions</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">- </span><span class="si">{</span><span class="n">suggestion</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Reason: </span><span class="si">{</span><span class="n">suggestion</span><span class="p">[</span><span class="s1">&#39;reason&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Affected files:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">suggestion</span><span class="p">[</span><span class="s1">&#39;chunks&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">file_path</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="plugin-development-recipes">Plugin Development Recipes<a class="headerlink" href="#plugin-development-recipes" title="Permanent link">&para;</a></h2>
<h3 id="creating-a-custom-language-plugin">Creating a Custom Language Plugin<a class="headerlink" href="#creating-a-custom-language-plugin" title="Permanent link">&para;</a></h3>
<p>Create a plugin for a language not yet supported.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">chunker.languages.plugin_base</span><span class="w"> </span><span class="kn">import</span> <span class="n">LanguagePlugin</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chunker</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_plugin_manager</span><span class="p">,</span> <span class="n">chunk_file</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tree_sitter</span><span class="w"> </span><span class="kn">import</span> <span class="n">Node</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SwiftPlugin</span><span class="p">(</span><span class="n">LanguagePlugin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plugin for Swift language support.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;func\s+(\w+)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">class_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;class\s+(\w+)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">struct_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;struct\s+(\w+)&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">language_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;swift&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">supported_extensions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;.swift&quot;</span><span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">default_chunk_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;function_declaration&quot;</span><span class="p">,</span>
            <span class="s2">&quot;init_declaration&quot;</span><span class="p">,</span>
            <span class="s2">&quot;class_declaration&quot;</span><span class="p">,</span>
            <span class="s2">&quot;struct_declaration&quot;</span><span class="p">,</span>
            <span class="s2">&quot;enum_declaration&quot;</span><span class="p">,</span>
            <span class="s2">&quot;protocol_declaration&quot;</span><span class="p">,</span>
            <span class="s2">&quot;extension_declaration&quot;</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_node_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract the name from a Swift node.&quot;&quot;&quot;</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">start_byte</span><span class="p">:</span><span class="n">node</span><span class="o">.</span><span class="n">end_byte</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">first_line</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Try different patterns</span>
        <span class="n">patterns</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;function_declaration&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_pattern</span><span class="p">,</span>
            <span class="s1">&#39;class_declaration&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_pattern</span><span class="p">,</span>
            <span class="s1">&#39;struct_declaration&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">struct_pattern</span>
        <span class="p">}</span>

        <span class="n">pattern</span> <span class="o">=</span> <span class="n">patterns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pattern</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">first_line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Fallback: extract identifier</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;identifier&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">source</span><span class="p">[</span><span class="n">child</span><span class="o">.</span><span class="n">start_byte</span><span class="p">:</span><span class="n">child</span><span class="o">.</span><span class="n">end_byte</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">should_include_chunk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply Swift-specific filtering.&quot;&quot;&quot;</span>
        <span class="c1"># Skip test files if configured</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">custom_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;skip_tests&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;test&#39;</span> <span class="ow">in</span> <span class="n">chunk</span><span class="o">.</span><span class="n">file_path</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="s1">&#39;Test&#39;</span> <span class="ow">in</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Skip private functions if configured</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">custom_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;skip_private&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;private &#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">should_include_chunk</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">parent_context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process Swift nodes with special handling.&quot;&quot;&quot;</span>
        <span class="n">chunk</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">process_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">parent_context</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">chunk</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;computed_property&quot;</span><span class="p">:</span>
            <span class="c1"># Add metadata for computed properties</span>
            <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;property_type&#39;</span><span class="p">:</span> <span class="s1">&#39;computed&#39;</span><span class="p">,</span>
                <span class="s1">&#39;has_getter&#39;</span><span class="p">:</span> <span class="s1">&#39;get {&#39;</span> <span class="ow">in</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
                <span class="s1">&#39;has_setter&#39;</span><span class="p">:</span> <span class="s1">&#39;set {&#39;</span> <span class="ow">in</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="n">chunk</span>

<span class="c1"># Usage example</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SwiftProjectAnalyzer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze Swift projects using the custom plugin.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manager</span> <span class="o">=</span> <span class="n">get_plugin_manager</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">register_plugin</span><span class="p">(</span><span class="n">SwiftPlugin</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_swift_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyze a Swift project structure.&quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

        <span class="n">swift_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">project_path</span><span class="p">)</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*.swift&quot;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">swift_files</span><span class="p">)</span><span class="si">}</span><span class="s2"> Swift files</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;total_chunks&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;by_type&#39;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s1">&#39;access_levels&#39;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s1">&#39;protocols&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;extensions&#39;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">swift_files</span><span class="p">:</span>
            <span class="n">chunks</span> <span class="o">=</span> <span class="n">chunk_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">),</span> <span class="s2">&quot;swift&quot;</span><span class="p">)</span>
            <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;total_chunks&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
                <span class="c1"># Count by type</span>
                <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;by_type&#39;</span><span class="p">][</span><span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;by_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

                <span class="c1"># Analyze access levels</span>
                <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="s1">&#39;internal&#39;</span><span class="p">,</span> <span class="s1">&#39;fileprivate&#39;</span><span class="p">,</span> <span class="s1">&#39;private&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">):</span>
                        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;access_levels&#39;</span><span class="p">][</span><span class="n">level</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;access_levels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

                <span class="c1"># Collect protocols and extensions</span>
                <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span> <span class="o">==</span> <span class="s2">&quot;protocol_declaration&quot;</span><span class="p">:</span>
                    <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;protocols&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_extract_name</span><span class="p">(</span><span class="n">chunk</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span> <span class="o">==</span> <span class="s2">&quot;extension_declaration&quot;</span><span class="p">:</span>
                    <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;extensions&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_extract_name</span><span class="p">(</span><span class="n">chunk</span><span class="p">))</span>

        <span class="c1"># Print analysis</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Swift Project Analysis:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total code chunks: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;total_chunks&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Chunk types:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">node_type</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;by_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">node_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Access levels:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">level</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;access_levels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Protocols defined: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;protocols&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extensions: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;extensions&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">stats</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract name from chunk content.&quot;&quot;&quot;</span>
        <span class="n">first_line</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?:protocol|extension)\s+(\w+)&#39;</span><span class="p">,</span> <span class="n">first_line</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">match</span> <span class="k">else</span> <span class="s2">&quot;Unknown&quot;</span>

<span class="c1"># Register and use the plugin</span>
<span class="n">analyzer</span> <span class="o">=</span> <span class="n">SwiftProjectAnalyzer</span><span class="p">()</span>

<span class="c1"># Analyze a Swift project</span>
<span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;MySwiftProject&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">analyze_swift_project</span><span class="p">(</span><span class="s2">&quot;MySwiftProject&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="plugin-with-custom-chunk-rules">Plugin with Custom Chunk Rules<a class="headerlink" href="#plugin-with-custom-chunk-rules" title="Permanent link">&para;</a></h3>
<p>Create a plugin with advanced chunking rules.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">chunker.languages.plugin_base</span><span class="w"> </span><span class="kn">import</span> <span class="n">LanguagePlugin</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chunker.languages.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChunkRule</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chunker</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_plugin_manager</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

<span class="k">class</span><span class="w"> </span><span class="nc">AdvancedPythonPlugin</span><span class="p">(</span><span class="n">LanguagePlugin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Enhanced Python plugin with custom chunk rules.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">language_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;python_advanced&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">supported_extensions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;.py&quot;</span><span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">default_chunk_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="c1"># Standard Python chunk types</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;function_definition&quot;</span><span class="p">,</span>
            <span class="s2">&quot;class_definition&quot;</span><span class="p">,</span>
            <span class="s2">&quot;async_function_definition&quot;</span><span class="p">,</span>
            <span class="s2">&quot;decorated_definition&quot;</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_chunk_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ChunkRule</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom chunking rules.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="c1"># Extract FastAPI endpoints</span>
            <span class="n">ChunkRule</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;fastapi_endpoint&quot;</span><span class="p">,</span>
                <span class="n">node_type</span><span class="o">=</span><span class="s2">&quot;decorated_definition&quot;</span><span class="p">,</span>
                <span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;@(app|router)\.(get|post|put|delete|patch)&#39;</span><span class="p">,</span>
                <span class="n">priority</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                <span class="n">metadata_extractor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_extract_endpoint_metadata</span>
            <span class="p">),</span>

            <span class="c1"># Extract Django views</span>
            <span class="n">ChunkRule</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;django_view&quot;</span><span class="p">,</span>
                <span class="n">node_type</span><span class="o">=</span><span class="s2">&quot;class_definition&quot;</span><span class="p">,</span>
                <span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;class\s+\w+\s*\(.*View.*\)&#39;</span><span class="p">,</span>
                <span class="n">priority</span><span class="o">=</span><span class="mi">90</span>
            <span class="p">),</span>

            <span class="c1"># Extract test classes and functions</span>
            <span class="n">ChunkRule</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;test_case&quot;</span><span class="p">,</span>
                <span class="n">node_type</span><span class="o">=</span><span class="s2">&quot;function_definition&quot;</span><span class="p">,</span>
                <span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;def\s+test_\w+&#39;</span><span class="p">,</span>
                <span class="n">priority</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>
                <span class="n">parent_type</span><span class="o">=</span><span class="s2">&quot;class_definition&quot;</span>
            <span class="p">),</span>

            <span class="c1"># Extract dataclasses</span>
            <span class="n">ChunkRule</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dataclass&quot;</span><span class="p">,</span>
                <span class="n">node_type</span><span class="o">=</span><span class="s2">&quot;decorated_definition&quot;</span><span class="p">,</span>
                <span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;@dataclass&#39;</span><span class="p">,</span>
                <span class="n">priority</span><span class="o">=</span><span class="mi">85</span>
            <span class="p">),</span>

            <span class="c1"># Extract Pydantic models</span>
            <span class="n">ChunkRule</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;pydantic_model&quot;</span><span class="p">,</span>
                <span class="n">node_type</span><span class="o">=</span><span class="s2">&quot;class_definition&quot;</span><span class="p">,</span>
                <span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;class\s+\w+\s*\(.*BaseModel.*\)&#39;</span><span class="p">,</span>
                <span class="n">priority</span><span class="o">=</span><span class="mi">85</span>
            <span class="p">)</span>
        <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_endpoint_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract metadata from FastAPI endpoints.&quot;&quot;&quot;</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Extract HTTP method and path</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;@(?:app|router)\.(\w+)\([&quot;</span><span class="se">\&#39;</span><span class="s1">]([^&quot;</span><span class="se">\&#39;</span><span class="s1">]*)[&quot;</span><span class="se">\&#39;</span><span class="s1">\]&#39;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;http_method&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Extract response model</span>
        <span class="n">response_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;response_model=([\w\.]+)&#39;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response_match</span><span class="p">:</span>
            <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;response_model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Extract dependencies</span>
        <span class="n">deps</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Depends\(([\w\.]+)\)&#39;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">deps</span><span class="p">:</span>
            <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;dependencies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">deps</span>

        <span class="k">return</span> <span class="n">metadata</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_node_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract name with special handling for decorators.&quot;&quot;&quot;</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">start_byte</span><span class="p">:</span><span class="n">node</span><span class="o">.</span><span class="n">end_byte</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

        <span class="c1"># For decorated functions, skip decorators</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;def &#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;class &#39;</span><span class="p">):</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?:def|class)\s+(\w+)&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span>

<span class="c1"># Example: Analyze a FastAPI project</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FastAPIAnalyzer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze FastAPI projects with custom rules.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manager</span> <span class="o">=</span> <span class="n">get_plugin_manager</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">register_plugin</span><span class="p">(</span><span class="n">AdvancedPythonPlugin</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_api_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyze FastAPI project structure.&quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">chunker</span><span class="w"> </span><span class="kn">import</span> <span class="n">chunk_file</span>

        <span class="n">endpoints</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">models</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">py_file</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="n">project_path</span><span class="p">)</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*.py&quot;</span><span class="p">):</span>
            <span class="n">chunks</span> <span class="o">=</span> <span class="n">chunk_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">py_file</span><span class="p">),</span> <span class="s2">&quot;python_advanced&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="s1">&#39;metadata&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="s1">&#39;http_method&#39;</span> <span class="ow">in</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span>
                        <span class="n">endpoints</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">py_file</span><span class="p">),</span>
                            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;http_method&#39;</span><span class="p">],</span>
                            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">),</span>
                            <span class="s1">&#39;response_model&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;response_model&#39;</span><span class="p">),</span>
                            <span class="s1">&#39;dependencies&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dependencies&#39;</span><span class="p">,</span> <span class="p">[])</span>
                        <span class="p">})</span>
                    <span class="k">elif</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span> <span class="o">==</span> <span class="s2">&quot;pydantic_model&quot;</span><span class="p">:</span>
                        <span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">py_file</span><span class="p">),</span>
                            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_class_name</span><span class="p">(</span><span class="n">chunk</span><span class="p">),</span>
                            <span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_model_fields</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                        <span class="p">})</span>

        <span class="c1"># Generate API documentation</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FastAPI Project Structure:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Endpoints (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">endpoints</span><span class="p">)</span><span class="si">}</span><span class="s2">):&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ep</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">endpoints</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">])):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">ep</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">6</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">ep</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">30</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">ep</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ep</span><span class="p">[</span><span class="s1">&#39;response_model&#39;</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;         Response: </span><span class="si">{</span><span class="n">ep</span><span class="p">[</span><span class="s1">&#39;response_model&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Models (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">models</span><span class="p">)</span><span class="si">}</span><span class="s2">):&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">model</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="s1">&#39;fields&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> fields)&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;endpoints&#39;</span><span class="p">:</span> <span class="n">endpoints</span><span class="p">,</span> <span class="s1">&#39;models&#39;</span><span class="p">:</span> <span class="n">models</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_class_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract class name from chunk.&quot;&quot;&quot;</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;class\s+(\w+)&#39;</span><span class="p">,</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">match</span> <span class="k">else</span> <span class="s2">&quot;Unknown&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_model_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract Pydantic model fields.&quot;&quot;&quot;</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>  <span class="c1"># Skip class definition</span>
            <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">):</span>
                <span class="n">field_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s*(\w+)\s*:\s*([^=]+)&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">field_match</span><span class="p">:</span>
                    <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">field_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
                        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">field_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="p">})</span>
        <span class="k">return</span> <span class="n">fields</span>

<span class="c1"># Usage</span>
<span class="n">analyzer</span> <span class="o">=</span> <span class="n">FastAPIAnalyzer</span><span class="p">()</span>
<span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;fastapi_project&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="n">api_structure</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">analyze_api_structure</span><span class="p">(</span><span class="s2">&quot;fastapi_project&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="export-format-recipes">Export Format Recipes<a class="headerlink" href="#export-format-recipes" title="Permanent link">&para;</a></h2>
<h3 id="multi-format-export-pipeline">Multi-Format Export Pipeline<a class="headerlink" href="#multi-format-export-pipeline" title="Permanent link">&para;</a></h3>
<p>Export chunks to multiple formats with transformations.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">chunker</span><span class="w"> </span><span class="kn">import</span> <span class="n">chunk_file</span><span class="p">,</span> <span class="n">chunk_directory_parallel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chunker.export</span><span class="w"> </span><span class="kn">import</span> <span class="n">JSONExporter</span><span class="p">,</span> <span class="n">JSONLExporter</span><span class="p">,</span> <span class="n">SchemaType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chunker.exporters</span><span class="w"> </span><span class="kn">import</span> <span class="n">ParquetExporter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MultiFormatExporter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Export chunks to multiple formats with transformations.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exporters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;json&#39;</span><span class="p">:</span> <span class="n">JSONExporter</span><span class="p">(</span><span class="n">schema_type</span><span class="o">=</span><span class="n">SchemaType</span><span class="o">.</span><span class="n">NESTED</span><span class="p">),</span>
            <span class="s1">&#39;jsonl&#39;</span><span class="p">:</span> <span class="n">JSONLExporter</span><span class="p">(),</span>
            <span class="s1">&#39;parquet&#39;</span><span class="p">:</span> <span class="n">ParquetExporter</span><span class="p">(</span><span class="n">compression</span><span class="o">=</span><span class="s2">&quot;snappy&quot;</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">export_with_enrichment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunks</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">base_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Export chunks with additional metadata and transformations.&quot;&quot;&quot;</span>
        <span class="c1"># Enrich chunks with additional metadata</span>
        <span class="n">enriched_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enrich_chunks</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>

        <span class="c1"># Export to different formats</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># JSON with nested structure</span>
        <span class="n">json_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_nested.json&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exporters</span><span class="p">[</span><span class="s1">&#39;json&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">enriched_chunks</span><span class="p">,</span> <span class="n">json_path</span><span class="p">)</span>
        <span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;json&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json_path</span>

        <span class="c1"># JSONL for streaming</span>
        <span class="n">jsonl_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_stream.jsonl&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exporters</span><span class="p">[</span><span class="s1">&#39;jsonl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">enriched_chunks</span><span class="p">,</span> <span class="n">jsonl_path</span><span class="p">)</span>
        <span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;jsonl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jsonl_path</span>

        <span class="c1"># Parquet for analytics</span>
        <span class="n">parquet_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_analytics.parquet&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exporters</span><span class="p">[</span><span class="s1">&#39;parquet&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">enriched_chunks</span><span class="p">,</span> <span class="n">parquet_path</span><span class="p">)</span>
        <span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;parquet&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parquet_path</span>

        <span class="c1"># Custom CSV export</span>
        <span class="n">csv_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_summary.csv&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_export_to_csv</span><span class="p">(</span><span class="n">enriched_chunks</span><span class="p">,</span> <span class="n">csv_path</span><span class="p">)</span>
        <span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;csv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">csv_path</span>

        <span class="c1"># Generate summary report</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_summary_report</span><span class="p">(</span><span class="n">enriched_chunks</span><span class="p">,</span> <span class="n">outputs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">outputs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_enrich_chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunks</span><span class="p">:</span> <span class="n">List</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add additional metadata to chunks.&quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

        <span class="n">enriched</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chunks</span><span class="p">):</span>
            <span class="c1"># Create enriched chunk (preserve original)</span>
            <span class="n">enriched_chunk</span> <span class="o">=</span> <span class="n">chunk</span>

            <span class="c1"># Add metadata</span>
            <span class="n">enriched_chunk</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="s1">&#39;metadata&#39;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="n">enriched_chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span>
                <span class="s1">&#39;hash&#39;</span><span class="p">:</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">(),</span>
                <span class="s1">&#39;size_bytes&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)),</span>
                <span class="s1">&#39;line_count&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">end_line</span> <span class="o">-</span> <span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;complexity_estimate&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_complexity</span><span class="p">(</span><span class="n">chunk</span><span class="p">),</span>
                <span class="s1">&#39;extracted_at&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                <span class="s1">&#39;has_docstring&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_docstring</span><span class="p">(</span><span class="n">chunk</span><span class="p">),</span>
                <span class="s1">&#39;dependencies&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_dependencies</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
            <span class="p">})</span>

            <span class="n">enriched</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">enriched_chunk</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">enriched</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_estimate_complexity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Estimate chunk complexity.&quot;&quot;&quot;</span>
        <span class="n">complexity</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">keywords</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;if &#39;</span><span class="p">,</span> <span class="s1">&#39;for &#39;</span><span class="p">,</span> <span class="s1">&#39;while &#39;</span><span class="p">,</span> <span class="s1">&#39;try:&#39;</span><span class="p">,</span> <span class="s1">&#39;except:&#39;</span><span class="p">,</span> <span class="s1">&#39;elif &#39;</span><span class="p">,</span> <span class="s1">&#39;else:&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
            <span class="n">complexity</span> <span class="o">+=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">complexity</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_has_docstring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if chunk has a docstring.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;&quot;&quot;&quot;&#39;</span> <span class="ow">in</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span> <span class="ow">or</span> <span class="s2">&quot;&#39;&#39;&#39;&quot;</span> <span class="ow">in</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract imports/dependencies from chunk.&quot;&quot;&quot;</span>
        <span class="n">dependencies</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">language</span> <span class="o">==</span> <span class="s2">&quot;python&quot;</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
            <span class="n">imports</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?:from|import)\s+([\w\.]+)&#39;</span><span class="p">,</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="n">dependencies</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">imports</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dependencies</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_export_to_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunks</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Export summary to CSV.&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">Path</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span><span class="p">,</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">50</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;...&#39;</span><span class="p">,</span>
                <span class="s1">&#39;start_line&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span><span class="p">,</span>
                <span class="s1">&#39;end_line&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">end_line</span><span class="p">,</span>
                <span class="s1">&#39;lines&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">end_line</span> <span class="o">-</span> <span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;complexity&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;complexity_estimate&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s1">&#39;has_docstring&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;has_docstring&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="p">})</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_summary_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunks</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">outputs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a summary report of the export.&quot;&quot;&quot;</span>
        <span class="n">report</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;export_summary&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;total_chunks&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">),</span>
                <span class="s1">&#39;total_lines&#39;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">end_line</span> <span class="o">-</span> <span class="n">c</span><span class="o">.</span><span class="n">start_line</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">),</span>
                <span class="s1">&#39;languages&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">language</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">)),</span>
                <span class="s1">&#39;chunk_types&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">node_type</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">])</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()),</span>
                <span class="s1">&#39;files_processed&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">file_path</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">))</span>
            <span class="p">},</span>
            <span class="s1">&#39;complexity_stats&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;avg_complexity&#39;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;complexity_estimate&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">),</span>
                <span class="s1">&#39;max_complexity&#39;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;complexity_estimate&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">),</span>
                <span class="s1">&#39;complex_chunks&#39;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chunks</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;complexity_estimate&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="s1">&#39;output_files&#39;</span><span class="p">:</span> <span class="n">outputs</span><span class="p">,</span>
            <span class="s1">&#39;file_sizes&#39;</span><span class="p">:</span> <span class="p">{}</span>
        <span class="p">}</span>

        <span class="c1"># Add file sizes</span>
        <span class="k">for</span> <span class="n">format_name</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">outputs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">size_mb</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>
                <span class="n">report</span><span class="p">[</span><span class="s1">&#39;file_sizes&#39;</span><span class="p">][</span><span class="n">format_name</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">size_mb</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MB&quot;</span>

        <span class="c1"># Save report</span>
        <span class="n">report_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;json&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_report.json&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">report_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Export Summary:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total chunks: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;export_summary&#39;</span><span class="p">][</span><span class="s1">&#39;total_chunks&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total lines: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;export_summary&#39;</span><span class="p">][</span><span class="s1">&#39;total_lines&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average complexity: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;complexity_stats&#39;</span><span class="p">][</span><span class="s1">&#39;avg_complexity&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Output files:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">format_name</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">outputs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">report</span><span class="p">[</span><span class="s1">&#39;file_sizes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">format_name</span><span class="p">,</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">format_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Report saved to: </span><span class="si">{</span><span class="n">report_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Usage example</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ProjectExporter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Export entire projects with multiple formats.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exporter</span> <span class="o">=</span> <span class="n">MultiFormatExporter</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">export_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Export all code from a project.&quot;&quot;&quot;</span>
        <span class="n">output_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
        <span class="n">output_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Process project in parallel</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">chunk_directory_parallel</span><span class="p">(</span>
            <span class="n">project_path</span><span class="p">,</span>
            <span class="s2">&quot;python&quot;</span><span class="p">,</span>  <span class="c1"># Adjust for your project</span>
            <span class="n">pattern</span><span class="o">=</span><span class="s2">&quot;**/*.py&quot;</span><span class="p">,</span>
            <span class="n">max_workers</span><span class="o">=</span><span class="mi">8</span>
        <span class="p">)</span>

        <span class="c1"># Flatten results</span>
        <span class="n">all_chunks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">file_chunks</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">all_chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">file_chunks</span><span class="p">)</span>

        <span class="c1"># Export with enrichment</span>
        <span class="n">base_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">output_path</span> <span class="o">/</span> <span class="s2">&quot;project_chunks&quot;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exporter</span><span class="o">.</span><span class="n">export_with_enrichment</span><span class="p">(</span><span class="n">all_chunks</span><span class="p">,</span> <span class="n">base_name</span><span class="p">)</span>

        <span class="c1"># Create partitioned Parquet for large datasets</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_chunks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_partitioned_export</span><span class="p">(</span><span class="n">all_chunks</span><span class="p">,</span> <span class="n">output_path</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">outputs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_partitioned_export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunks</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create partitioned Parquet export for large datasets.&quot;&quot;&quot;</span>
        <span class="n">exporter</span> <span class="o">=</span> <span class="n">ParquetExporter</span><span class="p">()</span>

        <span class="c1"># Export with partitioning by language and node type</span>
        <span class="n">partitioned_dir</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="s2">&quot;partitioned_chunks&quot;</span>
        <span class="n">exporter</span><span class="o">.</span><span class="n">export_partitioned</span><span class="p">(</span>
            <span class="n">chunks</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">partitioned_dir</span><span class="p">),</span>
            <span class="n">partition_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;language&quot;</span><span class="p">,</span> <span class="s2">&quot;node_type&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Created partitioned export in: </span><span class="si">{</span><span class="n">partitioned_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Partitions:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">partition</span> <span class="ow">in</span> <span class="n">partitioned_dir</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*.parquet&quot;</span><span class="p">):</span>
            <span class="n">rel_path</span> <span class="o">=</span> <span class="n">partition</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">partitioned_dir</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">rel_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Usage</span>
<span class="n">exporter</span> <span class="o">=</span> <span class="n">ProjectExporter</span><span class="p">()</span>

<span class="c1"># Export a project</span>
<span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;my_project&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">exporter</span><span class="o">.</span><span class="n">export_project</span><span class="p">(</span><span class="s2">&quot;my_project&quot;</span><span class="p">,</span> <span class="s2">&quot;exports&quot;</span><span class="p">)</span>

    <span class="c1"># Read back the Parquet file for analysis</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;parquet&#39;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">DataFrame shape: </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Columns: </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="custom-export-format-for-documentation">Custom Export Format for Documentation<a class="headerlink" href="#custom-export-format-for-documentation" title="Permanent link">&para;</a></h3>
<p>Create a custom Markdown export for documentation generation.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">chunker</span><span class="w"> </span><span class="kn">import</span> <span class="n">chunk_file</span><span class="p">,</span> <span class="n">CodeChunk</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MarkdownDocExporter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Export chunks as structured Markdown documentation.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toc_entries</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">export_to_markdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">CodeChunk</span><span class="p">],</span> <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
                          <span class="n">project_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Project&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Export chunks as formatted Markdown documentation.&quot;&quot;&quot;</span>
        <span class="c1"># Group chunks by file</span>
        <span class="n">chunks_by_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_by_file</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>

        <span class="c1"># Generate documentation</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;# </span><span class="si">{</span><span class="n">project_name</span><span class="si">}</span><span class="s2"> Code Documentation</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;*Auto-generated documentation from source code*</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;## Table of Contents</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">]</span>

        <span class="c1"># Generate TOC</span>
        <span class="n">toc_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">file_chunks</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">chunks_by_file</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
            <span class="n">anchor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_anchor</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
            <span class="n">toc_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- [</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">](#</span><span class="si">{</span><span class="n">anchor</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

            <span class="c1"># Add sub-items</span>
            <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">file_chunks</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;class_definition&quot;</span><span class="p">,</span> <span class="s2">&quot;function_definition&quot;</span><span class="p">]:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_name</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
                        <span class="n">sub_anchor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_anchor</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">toc_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - [</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">](#</span><span class="si">{</span><span class="n">sub_anchor</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

        <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">toc_lines</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">---</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Generate documentation for each file</span>
        <span class="k">for</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">file_chunks</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">chunks_by_file</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_file_doc</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">file_chunks</span><span class="p">))</span>

        <span class="c1"># Add index</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_index</span><span class="p">(</span><span class="n">chunks</span><span class="p">))</span>

        <span class="c1"># Write to file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">))</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Documentation exported to: </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_group_by_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">CodeChunk</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">CodeChunk</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Group chunks by source file.&quot;&quot;&quot;</span>
        <span class="n">grouped</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">file_path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">grouped</span><span class="p">:</span>
                <span class="n">grouped</span><span class="p">[</span><span class="n">chunk</span><span class="o">.</span><span class="n">file_path</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">grouped</span><span class="p">[</span><span class="n">chunk</span><span class="o">.</span><span class="n">file_path</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">grouped</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_file_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">chunks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">CodeChunk</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate documentation for a single file.&quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>

        <span class="c1"># File header</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;## </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;*</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">*</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># File summary</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_file_summary</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Document each chunk</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;class_definition&quot;</span><span class="p">,</span> <span class="s2">&quot;function_definition&quot;</span><span class="p">,</span> 
                                  <span class="s2">&quot;method_definition&quot;</span><span class="p">]:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_document_chunk</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="n">file_name</span><span class="p">))</span>

        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;---</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lines</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_file_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">CodeChunk</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a summary of the file contents.&quot;&quot;&quot;</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
            <span class="n">counts</span><span class="p">[</span><span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">summary_parts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;class_definition&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">summary_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="s1">&#39;class_definition&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> classes&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;function_definition&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">summary_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="s1">&#39;function_definition&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> functions&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;This file contains </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">summary_parts</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span> <span class="k">if</span> <span class="n">summary_parts</span> <span class="k">else</span> <span class="s2">&quot;This file contains code chunks.&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_document_chunk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">:</span> <span class="n">CodeChunk</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Document a single code chunk.&quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_name</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lines</span>

        <span class="c1"># Section header</span>
        <span class="n">level</span> <span class="o">=</span> <span class="s2">&quot;###&quot;</span> <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">parent_context</span> <span class="k">else</span> <span class="s2">&quot;###&quot;</span>
        <span class="n">anchor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_anchor</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Metadata</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">parent_context</span><span class="p">:</span>
            <span class="n">metadata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;*Parent: </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">parent_context</span><span class="si">}</span><span class="s2">*&quot;</span><span class="p">)</span>
        <span class="n">metadata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;*Lines </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">end_line</span><span class="si">}</span><span class="s2">*&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">metadata</span><span class="p">))</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Extract docstring</span>
        <span class="n">docstring</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_docstring</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">docstring</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&gt; </span><span class="si">{</span><span class="n">docstring</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Function signature</span>
        <span class="n">signature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_signature</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">signature</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;```&quot;</span> <span class="o">+</span> <span class="n">chunk</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">signature</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;```&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Extract parameters (for functions)</span>
        <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;function_definition&quot;</span><span class="p">,</span> <span class="s2">&quot;method_definition&quot;</span><span class="p">]:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_parameters</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;**Parameters:**&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- `</span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">`: </span><span class="si">{</span><span class="n">param</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Any&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Add any additional metadata</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="s1">&#39;metadata&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;**Metadata:**&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">chunk</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">lines</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">CodeChunk</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate an alphabetical index.&quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Index</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>

        <span class="c1"># Collect all named chunks</span>
        <span class="n">index_entries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_name</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">index_entries</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span><span class="p">,</span>
                    <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">Path</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span>
                <span class="p">})</span>

        <span class="c1"># Sort alphabetically</span>
        <span class="n">index_entries</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

        <span class="c1"># Group by first letter</span>
        <span class="n">current_letter</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">index_entries</span><span class="p">:</span>
            <span class="n">first_letter</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">first_letter</span> <span class="o">!=</span> <span class="n">current_letter</span><span class="p">:</span>
                <span class="n">current_letter</span> <span class="o">=</span> <span class="n">first_letter</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">### </span><span class="si">{</span><span class="n">current_letter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- **</span><span class="si">{</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">** (</span><span class="si">{</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">) - &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">lines</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">:</span> <span class="n">CodeChunk</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract the name of a function or class.&quot;&quot;&quot;</span>
        <span class="n">first_line</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">patterns</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;python&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;(?:def|class)\s+(\w+)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;javascript&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;(?:function|class|const|let|var)\s+(\w+)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;rust&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;(?:fn|struct|impl|trait)\s+(\w+)&#39;</span>
        <span class="p">}</span>

        <span class="n">pattern</span> <span class="o">=</span> <span class="n">patterns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;(\w+)&#39;</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">first_line</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">match</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_docstring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">:</span> <span class="n">CodeChunk</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract docstring from chunk.&quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;&quot;&quot;&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">or</span> <span class="s2">&quot;&#39;&#39;&#39;&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="c1"># Simple single-line docstring</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;&#39;&#39;&#39;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;&#39;&#39;&#39;&quot;</span><span class="p">)</span>
                <span class="c1"># Multi-line docstring</span>
                <span class="n">quote</span> <span class="o">=</span> <span class="s1">&#39;&quot;&quot;&quot;&#39;</span> <span class="k">if</span> <span class="s1">&#39;&quot;&quot;&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="k">else</span> <span class="s2">&quot;&#39;&#39;&#39;&quot;</span>
                <span class="n">docstring_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">quote</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">quote</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                        <span class="n">docstring_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">quote</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                        <span class="k">break</span>
                    <span class="n">docstring_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">docstring_lines</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_signature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">:</span> <span class="n">CodeChunk</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract function/class signature.&quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">signature_lines</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">signature_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
                <span class="k">break</span>

        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">signature_lines</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">:</span> <span class="n">CodeChunk</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract function parameters.&quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">language</span> <span class="o">==</span> <span class="s2">&quot;python&quot;</span><span class="p">:</span>
            <span class="c1"># Extract from function signature</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;def\s+\w+\s*\(([^)]*)\)&#39;</span><span class="p">,</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">param_str</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">param_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
                    <span class="n">param</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">param</span> <span class="ow">and</span> <span class="n">param</span> <span class="o">!=</span> <span class="s1">&#39;self&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
                            <span class="n">name</span><span class="p">,</span> <span class="n">type_hint</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">type_hint</span><span class="o">.</span><span class="n">strip</span><span class="p">()})</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">param</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Any&#39;</span><span class="p">})</span>

        <span class="k">return</span> <span class="n">params</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_make_anchor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a valid markdown anchor from text.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^a-zA-Z0-9-]&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

<span class="c1"># Usage</span>
<span class="n">exporter</span> <span class="o">=</span> <span class="n">MarkdownDocExporter</span><span class="p">()</span>

<span class="c1"># Export documentation for a project</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chunker</span><span class="w"> </span><span class="kn">import</span> <span class="n">chunk_directory_parallel</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">chunk_directory_parallel</span><span class="p">(</span><span class="s2">&quot;src/&quot;</span><span class="p">,</span> <span class="s2">&quot;python&quot;</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="s2">&quot;**/*.py&quot;</span><span class="p">)</span>
<span class="n">all_chunks</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">chunks</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
    <span class="n">all_chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>

<span class="n">exporter</span><span class="o">.</span><span class="n">export_to_markdown</span><span class="p">(</span>
    <span class="n">all_chunks</span><span class="p">,</span>
    <span class="s2">&quot;project_documentation.md&quot;</span><span class="p">,</span>
    <span class="n">project_name</span><span class="o">=</span><span class="s2">&quot;My Python Project&quot;</span>
<span class="p">)</span>
</code></pre></div>

<h2 id="aiml-integration">AI/ML Integration<a class="headerlink" href="#aiml-integration" title="Permanent link">&para;</a></h2>
<h3 id="generate-code-embeddings-for-semantic-search">Generate Code Embeddings for Semantic Search<a class="headerlink" href="#generate-code-embeddings-for-semantic-search" title="Permanent link">&para;</a></h3>
<p>Create vector embeddings for semantic code search.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">chunker.chunker</span><span class="w"> </span><span class="kn">import</span> <span class="n">chunk_file</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chunker.parser</span><span class="w"> </span><span class="kn">import</span> <span class="n">list_languages</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sentence_transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">SentenceTransformer</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">faiss</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CodeEmbeddingSystem</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Semantic code search using embeddings.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;microsoft/codebert-base&#39;</span><span class="p">):</span>
        <span class="c1"># Use a code-specific model if available</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># Fallback to general model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="s1">&#39;all-MiniLM-L6-v2&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">index_codebase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Index all code in directory with embeddings.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Indexing codebase...&quot;</span><span class="p">)</span>

        <span class="c1"># Collect all chunks</span>
        <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;python&#39;</span><span class="p">,</span> <span class="s1">&#39;javascript&#39;</span><span class="p">,</span> <span class="s1">&#39;rust&#39;</span><span class="p">]:</span>
            <span class="n">ext_map</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;python&#39;</span><span class="p">:</span> <span class="s1">&#39;.py&#39;</span><span class="p">,</span> <span class="s1">&#39;javascript&#39;</span><span class="p">:</span> <span class="s1">&#39;.js&#39;</span><span class="p">,</span> <span class="s1">&#39;rust&#39;</span><span class="p">:</span> <span class="s1">&#39;.rs&#39;</span><span class="p">}</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;*</span><span class="si">{</span><span class="n">ext_map</span><span class="p">[</span><span class="n">lang</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="n">pattern</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_skip</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
                    <span class="k">continue</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">chunks</span> <span class="o">=</span> <span class="n">chunk_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">),</span> <span class="n">lang</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chunks</span><span class="p">)</span><span class="si">}</span><span class="s2"> code chunks&quot;</span><span class="p">)</span>

        <span class="c1"># Generate embeddings</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Generating embeddings...&quot;</span><span class="p">)</span>
        <span class="n">texts</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_create_embedding_text</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span> <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunks</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">texts</span><span class="p">,</span> <span class="n">show_progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Create FAISS index</span>
        <span class="n">dimension</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">faiss</span><span class="o">.</span><span class="n">IndexFlatL2</span><span class="p">(</span><span class="n">dimension</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">))</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Indexed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chunks</span><span class="p">)</span><span class="si">}</span><span class="s2"> chunks with </span><span class="si">{</span><span class="n">dimension</span><span class="si">}</span><span class="s2">-dimensional embeddings&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_should_skip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if file should be skipped.&quot;&quot;&quot;</span>
        <span class="n">skip_patterns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;__pycache__&#39;</span><span class="p">,</span> <span class="s1">&#39;node_modules&#39;</span><span class="p">,</span> <span class="s1">&#39;.git&#39;</span><span class="p">,</span> <span class="s1">&#39;venv&#39;</span><span class="p">,</span> <span class="s1">&#39;test_&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">pattern</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">skip_patterns</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_embedding_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create text representation for embedding.&quot;&quot;&quot;</span>
        <span class="c1"># Combine context with code</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Add metadata</span>
        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Language: </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">language</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Type: </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">parent_context</span><span class="p">:</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Context: </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">parent_context</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Add function/class name</span>
        <span class="n">first_line</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Signature: </span><span class="si">{</span><span class="n">first_line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Add docstring if present</span>
        <span class="n">docstring</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_docstring</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">docstring</span><span class="p">:</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Description: </span><span class="si">{</span><span class="n">docstring</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Add simplified code</span>
        <span class="n">code_summary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summarize_code</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Code: </span><span class="si">{</span><span class="n">code_summary</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_docstring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract docstring from code.&quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]):</span>
            <span class="k">if</span> <span class="s1">&#39;&quot;&quot;&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">or</span> <span class="s2">&quot;&#39;&#39;&#39;&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;&#39;&#39;&#39;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_summarize_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a summary of the code for embedding.&quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Keep important lines (function calls, returns, etc.)</span>
        <span class="n">important_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">keywords</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;return&#39;</span><span class="p">,</span> <span class="s1">&#39;yield&#39;</span><span class="p">,</span> <span class="s1">&#39;raise&#39;</span><span class="p">,</span> <span class="s1">&#39;import&#39;</span><span class="p">,</span> <span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;def&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[:</span><span class="mi">20</span><span class="p">]:</span>  <span class="c1"># Limit to first 20 lines</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">keyword</span> <span class="ow">in</span> <span class="n">line</span> <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">):</span>
                <span class="n">important_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">important_lines</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>  <span class="c1"># Limit summary length</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Search for code similar to query.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Index not built. Call index_codebase() first.&quot;</span><span class="p">)</span>

        <span class="c1"># Encode query</span>
        <span class="n">query_embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">encode</span><span class="p">([</span><span class="n">query</span><span class="p">])</span>

        <span class="c1"># Search</span>
        <span class="n">distances</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">query_embedding</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">),</span> <span class="n">top_k</span><span class="p">)</span>

        <span class="c1"># Build results</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">distance</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">distances</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chunks</span><span class="p">):</span>
                <span class="n">chunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunks</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;chunk&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="p">,</span>
                    <span class="s1">&#39;distance&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">distance</span><span class="p">),</span>
                    <span class="s1">&#39;similarity&#39;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">distance</span><span class="p">)),</span>  <span class="c1"># Convert distance to similarity</span>
                    <span class="s1">&#39;preview&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">})</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_similar_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find functions similar to a given chunk.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">chunk_index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid chunk index&quot;</span><span class="p">)</span>

        <span class="c1"># Get embedding for the chunk</span>
        <span class="n">query_embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">[</span><span class="n">chunk_index</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Search (excluding the query itself)</span>
        <span class="n">distances</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">query_embedding</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">),</span> <span class="n">top_k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Build results (skip first result which is the query itself)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">distance</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span> <span class="n">distances</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chunks</span><span class="p">):</span>
                <span class="n">chunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunks</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;chunk&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="p">,</span>
                    <span class="s1">&#39;distance&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">distance</span><span class="p">),</span>
                    <span class="s1">&#39;similarity&#39;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">distance</span><span class="p">))</span>
                <span class="p">})</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the embedding system.&quot;&quot;&quot;</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">save_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Save chunks</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_path</span> <span class="o">/</span> <span class="s2">&quot;chunks.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chunks</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

        <span class="c1"># Save embeddings</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">save_path</span> <span class="o">/</span> <span class="s2">&quot;embeddings.npy&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span>

        <span class="c1"># Save FAISS index</span>
        <span class="n">faiss</span><span class="o">.</span><span class="n">write_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">save_path</span> <span class="o">/</span> <span class="s2">&quot;index.faiss&quot;</span><span class="p">))</span>

        <span class="c1"># Save metadata</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;num_chunks&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chunks</span><span class="p">),</span>
            <span class="s1">&#39;embedding_dim&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="s1">&#39;model_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_modules</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">auto_model</span><span class="o">.</span><span class="n">name_or_path</span>
        <span class="p">}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_path</span> <span class="o">/</span> <span class="s2">&quot;metadata.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load saved embedding system.&quot;&quot;&quot;</span>
        <span class="n">load_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c1"># Load chunks</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">load_path</span> <span class="o">/</span> <span class="s2">&quot;chunks.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chunks</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="c1"># Load embeddings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">load_path</span> <span class="o">/</span> <span class="s2">&quot;embeddings.npy&quot;</span><span class="p">)</span>

        <span class="c1"># Load FAISS index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">faiss</span><span class="o">.</span><span class="n">read_index</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">load_path</span> <span class="o">/</span> <span class="s2">&quot;index.faiss&quot;</span><span class="p">))</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chunks</span><span class="p">)</span><span class="si">}</span><span class="s2"> chunks&quot;</span><span class="p">)</span>

<span class="c1"># Usage example</span>
<span class="n">embedding_system</span> <span class="o">=</span> <span class="n">CodeEmbeddingSystem</span><span class="p">()</span>

<span class="c1"># Index your codebase</span>
<span class="n">embedding_system</span><span class="o">.</span><span class="n">index_codebase</span><span class="p">(</span><span class="s2">&quot;./src&quot;</span><span class="p">)</span>

<span class="c1"># Search for code</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">embedding_system</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;function that handles user authentication&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Search Results:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results</span><span class="p">[:</span><span class="mi">5</span><span class="p">]):</span>
    <span class="n">chunk</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;chunk&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">file_path</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Similarity: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;similarity&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Type: </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Preview: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;preview&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Find similar functions</span>
<span class="n">chunk_idx</span> <span class="o">=</span> <span class="mi">42</span>  <span class="c1"># Example chunk</span>
<span class="n">similar</span> <span class="o">=</span> <span class="n">embedding_system</span><span class="o">.</span><span class="n">find_similar_functions</span><span class="p">(</span><span class="n">chunk_idx</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Functions similar to chunk </span><span class="si">{</span><span class="n">chunk_idx</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">similar</span><span class="p">:</span>
    <span class="n">chunk</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;chunk&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">file_path</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span><span class="si">}</span><span class="s2"> (similarity: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;similarity&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># Save for later use</span>
<span class="n">embedding_system</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;./code_embeddings&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="generate-training-data-for-code-models">Generate Training Data for Code Models<a class="headerlink" href="#generate-training-data-for-code-models" title="Permanent link">&para;</a></h3>
<p>Create datasets for training code understanding models.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">chunker.chunker</span><span class="w"> </span><span class="kn">import</span> <span class="n">chunk_file</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CodeDatasetGenerator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate training datasets from code.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_function_naming_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create dataset for function name prediction.&quot;&quot;&quot;</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">py_file</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*.py&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;__pycache__&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">py_file</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">chunks</span> <span class="o">=</span> <span class="n">chunk_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">py_file</span><span class="p">),</span> <span class="s2">&quot;python&quot;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span> <span class="o">==</span> <span class="s2">&quot;function_definition&quot;</span><span class="p">:</span>
                        <span class="c1"># Extract function name</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_function_name</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">or</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
                            <span class="k">continue</span>

                        <span class="c1"># Remove function name from code</span>
                        <span class="n">anonymized_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_anonymize_function</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

                        <span class="n">dataset</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s1">&#39;input&#39;</span><span class="p">:</span> <span class="n">anonymized_code</span><span class="p">,</span>
                            <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                            <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">py_file</span><span class="p">),</span>
                                <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span><span class="p">,</span>
                                <span class="s1">&#39;parent&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">parent_context</span>
                            <span class="p">}</span>
                        <span class="p">})</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing </span><span class="si">{</span><span class="n">py_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dataset</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_docstring_generation_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create dataset for docstring generation.&quot;&quot;&quot;</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">py_file</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*.py&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;__pycache__&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">py_file</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">chunks</span> <span class="o">=</span> <span class="n">chunk_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">py_file</span><span class="p">),</span> <span class="s2">&quot;python&quot;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;function_definition&quot;</span><span class="p">,</span> <span class="s2">&quot;class_definition&quot;</span><span class="p">]:</span>
                        <span class="n">docstring</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_docstring</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">docstring</span><span class="p">:</span>
                            <span class="k">continue</span>

                        <span class="c1"># Remove docstring from code</span>
                        <span class="n">code_without_docstring</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_docstring</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

                        <span class="n">dataset</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s1">&#39;input&#39;</span><span class="p">:</span> <span class="n">code_without_docstring</span><span class="p">,</span>
                            <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="n">docstring</span><span class="p">,</span>
                            <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">py_file</span><span class="p">),</span>
                                <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span><span class="p">,</span>
                                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span>
                            <span class="p">}</span>
                        <span class="p">})</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing </span><span class="si">{</span><span class="n">py_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dataset</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_code_completion_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">context_lines</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create dataset for code completion.&quot;&quot;&quot;</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">py_file</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*.py&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;__pycache__&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">py_file</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">py_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

                <span class="n">chunks</span> <span class="o">=</span> <span class="n">chunk_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">py_file</span><span class="p">),</span> <span class="s2">&quot;python&quot;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span> <span class="o">==</span> <span class="s2">&quot;function_definition&quot;</span><span class="p">:</span>
                        <span class="c1"># Create multiple completion examples from the function</span>
                        <span class="n">func_lines</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">func_lines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                            <span class="c1"># Get context (previous lines)</span>
                            <span class="n">start_idx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">context_lines</span><span class="p">)</span>
                            <span class="n">context</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">func_lines</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">i</span><span class="p">])</span>

                            <span class="c1"># Get completion target (current line)</span>
                            <span class="n">target</span> <span class="o">=</span> <span class="n">func_lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                            <span class="k">if</span> <span class="n">target</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">target</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">):</span>
                                <span class="n">dataset</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                                    <span class="s1">&#39;input&#39;</span><span class="p">:</span> <span class="n">context</span><span class="p">,</span>
                                    <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="n">target</span><span class="p">,</span>
                                    <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">py_file</span><span class="p">),</span>
                                        <span class="s1">&#39;function_line&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span><span class="p">,</span>
                                        <span class="s1">&#39;completion_line&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span> <span class="o">+</span> <span class="n">i</span>
                                    <span class="p">}</span>
                                <span class="p">})</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing </span><span class="si">{</span><span class="n">py_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dataset</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_bug_detection_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create synthetic bug detection dataset.&quot;&quot;&quot;</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">py_file</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*.py&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;__pycache__&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">py_file</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">chunks</span> <span class="o">=</span> <span class="n">chunk_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">py_file</span><span class="p">),</span> <span class="s2">&quot;python&quot;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span> <span class="o">==</span> <span class="s2">&quot;function_definition&quot;</span><span class="p">:</span>
                        <span class="c1"># Original (correct) code</span>
                        <span class="n">dataset</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
                            <span class="s1">&#39;has_bug&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="s1">&#39;bug_type&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">py_file</span><span class="p">),</span>
                                <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span>
                            <span class="p">}</span>
                        <span class="p">})</span>

                        <span class="c1"># Create buggy versions</span>
                        <span class="n">buggy_versions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_introduce_bugs</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">bug_type</span><span class="p">,</span> <span class="n">buggy_code</span> <span class="ow">in</span> <span class="n">buggy_versions</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">buggy_code</span> <span class="o">!=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
                                <span class="n">dataset</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                                    <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="n">buggy_code</span><span class="p">,</span>
                                    <span class="s1">&#39;has_bug&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                                    <span class="s1">&#39;bug_type&#39;</span><span class="p">:</span> <span class="n">bug_type</span><span class="p">,</span>
                                    <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">py_file</span><span class="p">),</span>
                                        <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span><span class="p">,</span>
                                        <span class="s1">&#39;original&#39;</span><span class="p">:</span> <span class="kc">False</span>
                                    <span class="p">}</span>
                                <span class="p">})</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing </span><span class="si">{</span><span class="n">py_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dataset</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_function_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract function name from code.&quot;&quot;&quot;</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;def\s+(\w+)&#39;</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">match</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_anonymize_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Replace function name with placeholder.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;\bdef\s+</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">\b&#39;</span><span class="p">,</span> <span class="s1">&#39;def &lt;FUNCTION_NAME&gt;&#39;</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_docstring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract docstring from code.&quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">in_docstring</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">docstring_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">quote_style</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>  <span class="c1"># Skip function/class definition</span>
            <span class="n">stripped</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">in_docstring</span> <span class="ow">and</span> <span class="p">(</span><span class="n">stripped</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">stripped</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;&#39;&#39;&#39;&quot;</span><span class="p">)):</span>
                <span class="n">quote_style</span> <span class="o">=</span> <span class="s1">&#39;&quot;&quot;&quot;&#39;</span> <span class="k">if</span> <span class="n">stripped</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&#39;&#39;&#39;&quot;</span>
                <span class="n">in_docstring</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># Check for single-line docstring</span>
                <span class="k">if</span> <span class="n">stripped</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">quote_style</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">stripped</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">quote_style</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">docstring_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stripped</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">quote_style</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">in_docstring</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">quote_style</span> <span class="ow">in</span> <span class="n">stripped</span><span class="p">:</span>
                    <span class="n">docstring_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stripped</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">quote_style</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">docstring_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stripped</span><span class="p">)</span>

        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">docstring_lines</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">docstring_lines</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_remove_docstring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove docstring from code.&quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">result_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>  <span class="c1"># Keep function/class definition</span>

        <span class="n">in_docstring</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">quote_style</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">stripped</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">in_docstring</span> <span class="ow">and</span> <span class="p">(</span><span class="n">stripped</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">stripped</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;&#39;&#39;&#39;&quot;</span><span class="p">)):</span>
                <span class="n">quote_style</span> <span class="o">=</span> <span class="s1">&#39;&quot;&quot;&quot;&#39;</span> <span class="k">if</span> <span class="n">stripped</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&#39;&#39;&#39;&quot;</span>
                <span class="n">in_docstring</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># Check for single-line docstring</span>
                <span class="k">if</span> <span class="n">stripped</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">quote_style</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">in_docstring</span> <span class="ow">and</span> <span class="n">quote_style</span> <span class="ow">in</span> <span class="n">stripped</span><span class="p">:</span>
                <span class="n">in_docstring</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">in_docstring</span><span class="p">:</span>
                <span class="n">result_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result_lines</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_introduce_bugs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Introduce various types of bugs into code.&quot;&quot;&quot;</span>
        <span class="n">bugs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Off-by-one error</span>
        <span class="n">off_by_one</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;range\((\w+)\)&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;range(\1 + 1)&#39;</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">off_by_one</span> <span class="o">!=</span> <span class="n">code</span><span class="p">:</span>
            <span class="n">bugs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;off_by_one&#39;</span><span class="p">,</span> <span class="n">off_by_one</span><span class="p">))</span>

        <span class="c1"># Wrong operator</span>
        <span class="n">wrong_op</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span>  <span class="c1"># Dangerous but for synthetic data</span>
        <span class="k">if</span> <span class="n">wrong_op</span> <span class="o">!=</span> <span class="n">code</span><span class="p">:</span>
            <span class="n">bugs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;wrong_operator&#39;</span><span class="p">,</span> <span class="n">wrong_op</span><span class="p">))</span>

        <span class="c1"># Missing return</span>
        <span class="k">if</span> <span class="s1">&#39;return&#39;</span> <span class="ow">in</span> <span class="n">code</span><span class="p">:</span>
            <span class="n">no_return</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;return\s+.*$&#39;</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">no_return</span> <span class="o">!=</span> <span class="n">code</span><span class="p">:</span>
                <span class="n">bugs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;missing_return&#39;</span><span class="p">,</span> <span class="n">no_return</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">bugs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">split_ratio</span><span class="o">=</span><span class="mf">0.8</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save dataset with train/val split.&quot;&quot;&quot;</span>
        <span class="c1"># Shuffle</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>

        <span class="c1"># Split</span>
        <span class="n">split_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="o">*</span> <span class="n">split_ratio</span><span class="p">)</span>
        <span class="n">train_data</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[:</span><span class="n">split_idx</span><span class="p">]</span>
        <span class="n">val_data</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="n">split_idx</span><span class="p">:]</span>

        <span class="c1"># Save</span>
        <span class="n">base_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>
        <span class="n">base_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">base_path</span> <span class="o">/</span> <span class="s2">&quot;train.jsonl&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">train_data</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">base_path</span> <span class="o">/</span> <span class="s2">&quot;val.jsonl&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">val_data</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Save statistics</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;total_examples&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">),</span>
            <span class="s1">&#39;train_examples&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_data</span><span class="p">),</span>
            <span class="s1">&#39;val_examples&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">val_data</span><span class="p">),</span>
            <span class="s1">&#39;example_fields&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="k">if</span> <span class="n">dataset</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="p">}</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">base_path</span> <span class="o">/</span> <span class="s2">&quot;stats.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset saved to </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Train: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_data</span><span class="p">)</span><span class="si">}</span><span class="s2"> examples&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Val: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">val_data</span><span class="p">)</span><span class="si">}</span><span class="s2"> examples&quot;</span><span class="p">)</span>

<span class="c1"># Usage</span>
<span class="n">generator</span> <span class="o">=</span> <span class="n">CodeDatasetGenerator</span><span class="p">()</span>

<span class="c1"># Generate different datasets</span>
<span class="n">naming_dataset</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">create_function_naming_dataset</span><span class="p">(</span><span class="s2">&quot;./src&quot;</span><span class="p">)</span>
<span class="n">generator</span><span class="o">.</span><span class="n">save_dataset</span><span class="p">(</span><span class="n">naming_dataset</span><span class="p">,</span> <span class="s2">&quot;./datasets/function_naming&quot;</span><span class="p">)</span>

<span class="n">docstring_dataset</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">create_docstring_generation_dataset</span><span class="p">(</span><span class="s2">&quot;./src&quot;</span><span class="p">)</span>
<span class="n">generator</span><span class="o">.</span><span class="n">save_dataset</span><span class="p">(</span><span class="n">docstring_dataset</span><span class="p">,</span> <span class="s2">&quot;./datasets/docstring_generation&quot;</span><span class="p">)</span>

<span class="n">completion_dataset</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">create_code_completion_dataset</span><span class="p">(</span><span class="s2">&quot;./src&quot;</span><span class="p">)</span>
<span class="n">generator</span><span class="o">.</span><span class="n">save_dataset</span><span class="p">(</span><span class="n">completion_dataset</span><span class="p">,</span> <span class="s2">&quot;./datasets/code_completion&quot;</span><span class="p">)</span>

<span class="n">bug_dataset</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">create_bug_detection_dataset</span><span class="p">(</span><span class="s2">&quot;./src&quot;</span><span class="p">)</span>
<span class="n">generator</span><span class="o">.</span><span class="n">save_dataset</span><span class="p">(</span><span class="n">bug_dataset</span><span class="p">,</span> <span class="s2">&quot;./datasets/bug_detection&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="performance-optimization">Performance Optimization<a class="headerlink" href="#performance-optimization" title="Permanent link">&para;</a></h2>
<h3 id="using-new-parallel-processing-apis">Using New Parallel Processing APIs<a class="headerlink" href="#using-new-parallel-processing-apis" title="Permanent link">&para;</a></h3>
<p>Leverage the new parallel processing APIs for maximum performance.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">chunker</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">chunk_files_parallel</span><span class="p">,</span>
    <span class="n">chunk_directory_parallel</span><span class="p">,</span>
    <span class="n">ASTCache</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">class</span><span class="w"> </span><span class="nc">OptimizedBatchProcessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;High-performance batch processor using new APIs.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Configure for maximum performance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="n">ASTCache</span><span class="p">(</span><span class="n">max_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_large_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_root</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process a large project efficiently.&quot;&quot;&quot;</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># Process by language for better cache utilization</span>
        <span class="n">languages</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;python&#39;</span><span class="p">:</span> <span class="s1">&#39;**/*.py&#39;</span><span class="p">,</span>
            <span class="s1">&#39;javascript&#39;</span><span class="p">:</span> <span class="s1">&#39;**/*.js&#39;</span><span class="p">,</span>
            <span class="s1">&#39;rust&#39;</span><span class="p">:</span> <span class="s1">&#39;**/*.rs&#39;</span>
        <span class="p">}</span>

        <span class="n">all_results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">total_chunks</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">language</span><span class="p">,</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">languages</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Processing </span><span class="si">{</span><span class="n">language</span><span class="si">}</span><span class="s2"> files...&quot;</span><span class="p">)</span>

            <span class="c1"># Use the new parallel directory API</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">chunk_directory_parallel</span><span class="p">(</span>
                <span class="n">project_root</span><span class="p">,</span>
                <span class="n">language</span><span class="p">,</span>
                <span class="n">pattern</span><span class="o">=</span><span class="n">pattern</span><span class="p">,</span>
                <span class="n">max_workers</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>  <span class="c1"># Adjust based on CPU</span>
                <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

            <span class="c1"># Aggregate results</span>
            <span class="n">language_chunks</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span> <span class="k">for</span> <span class="n">chunks</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="n">total_chunks</span> <span class="o">+=</span> <span class="n">language_chunks</span>
            <span class="n">all_results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Processed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">language</span><span class="si">}</span><span class="s2"> files&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Found </span><span class="si">{</span><span class="n">language_chunks</span><span class="si">}</span><span class="s2"> chunks&quot;</span><span class="p">)</span>

            <span class="c1"># Show cache performance</span>
            <span class="n">cache_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">get_stats</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Cache hit rate: </span><span class="si">{</span><span class="n">cache_stats</span><span class="p">[</span><span class="s1">&#39;hit_rate&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Summary</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Total Processing Summary:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Files: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_results</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Chunks: </span><span class="si">{</span><span class="n">total_chunks</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Duration: </span><span class="si">{</span><span class="n">duration</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Speed: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_results</span><span class="p">)</span><span class="o">/</span><span class="n">duration</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> files/sec&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">all_results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compare_sequential_vs_parallel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_files</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">language</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compare sequential vs parallel performance.&quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">chunker</span><span class="w"> </span><span class="kn">import</span> <span class="n">chunk_file</span>

        <span class="c1"># Sequential processing</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sequential processing...&quot;</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">sequential_results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">test_files</span><span class="p">:</span>
            <span class="n">sequential_results</span><span class="p">[</span><span class="n">file</span><span class="p">]</span> <span class="o">=</span> <span class="n">chunk_file</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">language</span><span class="p">)</span>
        <span class="n">sequential_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

        <span class="c1"># Clear cache for fair comparison</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1"># Parallel processing</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Parallel processing...&quot;</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">parallel_results</span> <span class="o">=</span> <span class="n">chunk_files_parallel</span><span class="p">(</span>
            <span class="n">test_files</span><span class="p">,</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="n">max_workers</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">show_progress</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">parallel_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

        <span class="c1"># Results</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Performance Comparison:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Sequential: </span><span class="si">{</span><span class="n">sequential_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Parallel: </span><span class="si">{</span><span class="n">parallel_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Speedup: </span><span class="si">{</span><span class="n">sequential_time</span><span class="o">/</span><span class="n">parallel_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Files processed: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">test_files</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;sequential_time&#39;</span><span class="p">:</span> <span class="n">sequential_time</span><span class="p">,</span>
            <span class="s1">&#39;parallel_time&#39;</span><span class="p">:</span> <span class="n">parallel_time</span><span class="p">,</span>
            <span class="s1">&#39;speedup&#39;</span><span class="p">:</span> <span class="n">sequential_time</span><span class="o">/</span><span class="n">parallel_time</span>
        <span class="p">}</span>

<span class="c1"># Usage</span>
<span class="n">processor</span> <span class="o">=</span> <span class="n">OptimizedBatchProcessor</span><span class="p">()</span>

<span class="c1"># Process entire project</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_large_project</span><span class="p">(</span><span class="s2">&quot;./large_project&quot;</span><span class="p">)</span>

<span class="c1"># Compare performance</span>
<span class="n">test_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;src/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.py&quot;</span><span class="p">))[:</span><span class="mi">20</span><span class="p">]</span>
<span class="k">if</span> <span class="n">test_files</span><span class="p">:</span>
    <span class="n">comparison</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">compare_sequential_vs_parallel</span><span class="p">(</span>
        <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">test_files</span><span class="p">],</span>
        <span class="s2">&quot;python&quot;</span>
    <span class="p">)</span>
</code></pre></div>

<h3 id="streaming-processing-for-huge-files">Streaming Processing for Huge Files<a class="headerlink" href="#streaming-processing-for-huge-files" title="Permanent link">&para;</a></h3>
<p>Handle files too large for memory using the streaming API.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">chunker</span><span class="w"> </span><span class="kn">import</span> <span class="n">chunk_file_streaming</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">psutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MemoryEfficientProcessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process huge files without loading them entirely into memory.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory_limit_mb</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memory_limit_bytes</span> <span class="o">=</span> <span class="n">memory_limit_mb</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_huge_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">language</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process a very large file using streaming.&quot;&quot;&quot;</span>
        <span class="n">file_size_mb</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">file_size_mb</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> MB)...&quot;</span><span class="p">)</span>

        <span class="c1"># Monitor memory usage</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
        <span class="n">initial_memory</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span>

        <span class="n">chunks_processed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">chunk_types</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Stream process the file</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunk_file_streaming</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">language</span><span class="p">):</span>
            <span class="n">chunks_processed</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Track chunk types</span>
            <span class="n">chunk_types</span><span class="p">[</span><span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">chunk_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="c1"># Process chunk immediately (don&#39;t store)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process_chunk</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>

            <span class="c1"># Check memory usage periodically</span>
            <span class="k">if</span> <span class="n">chunks_processed</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">current_memory</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span>
                <span class="n">memory_used</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_memory</span> <span class="o">-</span> <span class="n">initial_memory</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">Processed </span><span class="si">{</span><span class="n">chunks_processed</span><span class="si">}</span><span class="s2"> chunks, &quot;</span>
                      <span class="sa">f</span><span class="s2">&quot;Memory delta: </span><span class="si">{</span><span class="n">memory_used</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

                <span class="c1"># If approaching limit, trigger garbage collection</span>
                <span class="k">if</span> <span class="n">current_memory</span> <span class="o">&gt;</span> <span class="n">initial_memory</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_limit_bytes</span><span class="p">:</span>
                    <span class="kn">import</span><span class="w"> </span><span class="nn">gc</span>
                    <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="c1"># Final stats</span>
        <span class="n">final_memory</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span>
        <span class="n">total_memory_used</span> <span class="o">=</span> <span class="p">(</span><span class="n">final_memory</span> <span class="o">-</span> <span class="n">initial_memory</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Streaming Processing Complete:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  File size: </span><span class="si">{</span><span class="n">file_size_mb</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Chunks processed: </span><span class="si">{</span><span class="n">chunks_processed</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Memory used: </span><span class="si">{</span><span class="n">total_memory_used</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Memory efficiency: </span><span class="si">{</span><span class="n">total_memory_used</span><span class="o">/</span><span class="n">file_size_mb</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Chunk type distribution:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">node_type</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">chunk_types</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">node_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_chunk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process a single chunk without storing it.&quot;&quot;&quot;</span>
        <span class="c1"># Example: Write to database, send to API, etc.</span>
        <span class="c1"># This avoids keeping all chunks in memory</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">batch_process_large_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">size_threshold_mb</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process all large files in a directory using streaming.&quot;&quot;&quot;</span>
        <span class="n">large_files</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                <span class="n">size_mb</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">size_mb</span> <span class="o">&gt;</span> <span class="n">size_threshold_mb</span><span class="p">:</span>
                    <span class="n">ext</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.py&#39;</span><span class="p">,</span> <span class="s1">&#39;.js&#39;</span><span class="p">,</span> <span class="s1">&#39;.rs&#39;</span><span class="p">,</span> <span class="s1">&#39;.c&#39;</span><span class="p">,</span> <span class="s1">&#39;.cpp&#39;</span><span class="p">]:</span>
                        <span class="n">large_files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">file_path</span><span class="p">,</span> <span class="n">size_mb</span><span class="p">))</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">large_files</span><span class="p">)</span><span class="si">}</span><span class="s2"> large files (&gt;</span><span class="si">{</span><span class="n">size_threshold_mb</span><span class="si">}</span><span class="s2"> MB)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">size_mb</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">large_files</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">language</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detect_language</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">language</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">process_huge_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">),</span> <span class="n">language</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_detect_language</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Detect language from file extension.&quot;&quot;&quot;</span>
        <span class="n">ext_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;.py&#39;</span><span class="p">:</span> <span class="s1">&#39;python&#39;</span><span class="p">,</span>
            <span class="s1">&#39;.js&#39;</span><span class="p">:</span> <span class="s1">&#39;javascript&#39;</span><span class="p">,</span>
            <span class="s1">&#39;.rs&#39;</span><span class="p">:</span> <span class="s1">&#39;rust&#39;</span><span class="p">,</span>
            <span class="s1">&#39;.c&#39;</span><span class="p">:</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span>
            <span class="s1">&#39;.cpp&#39;</span><span class="p">:</span> <span class="s1">&#39;cpp&#39;</span><span class="p">,</span>
            <span class="s1">&#39;.cc&#39;</span><span class="p">:</span> <span class="s1">&#39;cpp&#39;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">ext_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">file_path</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

<span class="c1"># Usage</span>
<span class="n">processor</span> <span class="o">=</span> <span class="n">MemoryEfficientProcessor</span><span class="p">(</span><span class="n">memory_limit_mb</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

<span class="c1"># Process a single huge file</span>
<span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;huge_codebase.py&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="n">processor</span><span class="o">.</span><span class="n">process_huge_file</span><span class="p">(</span><span class="s2">&quot;huge_codebase.py&quot;</span><span class="p">,</span> <span class="s2">&quot;python&quot;</span><span class="p">)</span>

<span class="c1"># Process all large files in a directory</span>
<span class="n">processor</span><span class="o">.</span><span class="n">batch_process_large_files</span><span class="p">(</span><span class="s2">&quot;./large_project&quot;</span><span class="p">,</span> <span class="n">size_threshold_mb</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>

<h2 id="configuration-recipes">Configuration Recipes<a class="headerlink" href="#configuration-recipes" title="Permanent link">&para;</a></h2>
<h3 id="dynamic-configuration-based-on-project-type">Dynamic Configuration Based on Project Type<a class="headerlink" href="#dynamic-configuration-based-on-project-type" title="Permanent link">&para;</a></h3>
<p>Automatically configure based on detected project type.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">chunker</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChunkerConfig</span><span class="p">,</span> <span class="n">chunk_file</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">toml</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SmartConfigurator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Automatically configure chunker based on project characteristics.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_patterns</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;django&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;files&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;manage.py&#39;</span><span class="p">,</span> <span class="s1">&#39;settings.py&#39;</span><span class="p">],</span>
                <span class="s1">&#39;config&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;languages&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;python&#39;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s1">&#39;chunk_types&#39;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="s1">&#39;function_definition&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;class_definition&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;decorated_definition&#39;</span>
                            <span class="p">],</span>
                            <span class="s1">&#39;custom_options&#39;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s1">&#39;include_views&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                                <span class="s1">&#39;include_models&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                                <span class="s1">&#39;include_serializers&#39;</span><span class="p">:</span> <span class="kc">True</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s1">&#39;react&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;files&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;package.json&#39;</span><span class="p">,</span> <span class="s1">&#39;src/App.js&#39;</span><span class="p">],</span>
                <span class="s1">&#39;config&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;languages&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;javascript&#39;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s1">&#39;chunk_types&#39;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="s1">&#39;function_declaration&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;arrow_function&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;class_declaration&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;jsx_element&#39;</span>
                            <span class="p">],</span>
                            <span class="s1">&#39;custom_options&#39;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s1">&#39;include_jsx&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                                <span class="s1">&#39;include_hooks&#39;</span><span class="p">:</span> <span class="kc">True</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s1">&#39;rust&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;files&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Cargo.toml&#39;</span><span class="p">],</span>
                <span class="s1">&#39;config&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;languages&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;rust&#39;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s1">&#39;chunk_types&#39;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="s1">&#39;function_item&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;impl_item&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;trait_item&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;struct_item&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;enum_item&#39;</span>
                            <span class="p">],</span>
                            <span class="s1">&#39;custom_options&#39;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s1">&#39;include_tests&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                <span class="s1">&#39;include_macros&#39;</span><span class="p">:</span> <span class="kc">True</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect_project_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_root</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Detect the type of project.&quot;&quot;&quot;</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">project_root</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">project_type</span><span class="p">,</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_patterns</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">[</span><span class="s1">&#39;files&#39;</span><span class="p">]):</span>
                <span class="k">return</span> <span class="n">project_type</span>

        <span class="k">return</span> <span class="s1">&#39;generic&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_root</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChunkerConfig</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate optimal configuration for the project.&quot;&quot;&quot;</span>
        <span class="n">project_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect_project_type</span><span class="p">(</span><span class="n">project_root</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Detected project type: </span><span class="si">{</span><span class="n">project_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">project_type</span> <span class="o">==</span> <span class="s1">&#39;generic&#39;</span><span class="p">:</span>
            <span class="c1"># Analyze project to create custom config</span>
            <span class="n">config_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analyze_project</span><span class="p">(</span><span class="n">project_root</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">config_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_patterns</span><span class="p">[</span><span class="n">project_type</span><span class="p">][</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>

        <span class="c1"># Add common settings</span>
        <span class="n">config_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s1">&#39;cache_enabled&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;cache_size&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
            <span class="s1">&#39;parallel_workers&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="s1">&#39;exclude_patterns&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">&#39;*test*&#39;</span><span class="p">,</span> <span class="s1">&#39;__pycache__&#39;</span><span class="p">,</span> <span class="s1">&#39;node_modules&#39;</span><span class="p">,</span>
                <span class="s1">&#39;.git&#39;</span><span class="p">,</span> <span class="s1">&#39;.venv&#39;</span><span class="p">,</span> <span class="s1">&#39;build&#39;</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span>
            <span class="p">]</span>
        <span class="p">})</span>

        <span class="c1"># Save configuration</span>
        <span class="n">config_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">project_root</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;.chunkerrc&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_config</span><span class="p">(</span><span class="n">config_dict</span><span class="p">,</span> <span class="n">config_path</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated configuration saved to: </span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ChunkerConfig</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">config_path</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_analyze_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_root</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyze project structure to generate config.&quot;&quot;&quot;</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">project_root</span><span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;languages&#39;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s1">&#39;chunk_types&#39;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>

        <span class="c1"># Count files by extension</span>
        <span class="n">file_counts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                <span class="n">ext</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.py&#39;</span><span class="p">,</span> <span class="s1">&#39;.js&#39;</span><span class="p">,</span> <span class="s1">&#39;.rs&#39;</span><span class="p">,</span> <span class="s1">&#39;.c&#39;</span><span class="p">,</span> <span class="s1">&#39;.cpp&#39;</span><span class="p">]:</span>
                    <span class="n">file_counts</span><span class="p">[</span><span class="n">ext</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># Configure based on predominant languages</span>
        <span class="k">for</span> <span class="n">ext</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">file_counts</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;.py&#39;</span><span class="p">:</span>
                <span class="n">config</span><span class="p">[</span><span class="s1">&#39;languages&#39;</span><span class="p">][</span><span class="s1">&#39;python&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s1">&#39;chunk_types&#39;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s1">&#39;function_definition&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;class_definition&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;async_function_definition&#39;</span>
                    <span class="p">],</span>
                    <span class="s1">&#39;min_chunk_size&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                    <span class="s1">&#39;max_chunk_size&#39;</span><span class="p">:</span> <span class="mi">300</span>
                <span class="p">}</span>
            <span class="k">elif</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.js&#39;</span><span class="p">,</span> <span class="s1">&#39;.jsx&#39;</span><span class="p">]:</span>
                <span class="n">config</span><span class="p">[</span><span class="s1">&#39;languages&#39;</span><span class="p">][</span><span class="s1">&#39;javascript&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s1">&#39;chunk_types&#39;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s1">&#39;function_declaration&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;arrow_function&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;class_declaration&#39;</span>
                    <span class="p">]</span>
                <span class="p">}</span>

        <span class="k">return</span> <span class="n">config</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_save_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save configuration in appropriate format.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s1">&#39;.toml&#39;</span> <span class="ow">or</span> <span class="n">path</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;.chunkerrc&#39;</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">toml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">path</span><span class="o">.</span><span class="n">suffix</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;.yml&#39;</span><span class="p">]:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_environment_configs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_root</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create different configs for different environments.&quot;&quot;&quot;</span>
        <span class="n">base_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_config</span><span class="p">(</span><span class="n">project_root</span><span class="p">)</span>

        <span class="c1"># Development config</span>
        <span class="n">dev_config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;extends&#39;</span><span class="p">:</span> <span class="s1">&#39;.chunkerrc&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cache_size&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
            <span class="s1">&#39;log_level&#39;</span><span class="p">:</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span>
            <span class="s1">&#39;include_tests&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;languages&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;python&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;custom_options&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;include_docstrings&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                        <span class="s1">&#39;include_type_hints&#39;</span><span class="p">:</span> <span class="kc">True</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1"># Production config</span>
        <span class="n">prod_config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;extends&#39;</span><span class="p">:</span> <span class="s1">&#39;.chunkerrc&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cache_size&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
            <span class="s1">&#39;log_level&#39;</span><span class="p">:</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">,</span>
            <span class="s1">&#39;include_tests&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;min_chunk_size&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s1">&#39;exclude_patterns&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">&#39;*test*&#39;</span><span class="p">,</span> <span class="s1">&#39;*_test.py&#39;</span><span class="p">,</span> <span class="s1">&#39;test_*.py&#39;</span><span class="p">,</span>
                <span class="s1">&#39;__pycache__&#39;</span><span class="p">,</span> <span class="s1">&#39;.pytest_cache&#39;</span>
            <span class="p">]</span>
        <span class="p">}</span>

        <span class="c1"># CI config</span>
        <span class="n">ci_config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;extends&#39;</span><span class="p">:</span> <span class="s1">&#39;.chunkerrc&#39;</span><span class="p">,</span>
            <span class="s1">&#39;parallel_workers&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s1">&#39;show_progress&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;output_format&#39;</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span>
            <span class="s1">&#39;fail_on_error&#39;</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">}</span>

        <span class="c1"># Save environment configs</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">project_root</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_config</span><span class="p">(</span><span class="n">dev_config</span><span class="p">,</span> <span class="n">root</span> <span class="o">/</span> <span class="s1">&#39;chunker.dev.toml&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_config</span><span class="p">(</span><span class="n">prod_config</span><span class="p">,</span> <span class="n">root</span> <span class="o">/</span> <span class="s1">&#39;chunker.prod.toml&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_config</span><span class="p">(</span><span class="n">ci_config</span><span class="p">,</span> <span class="n">root</span> <span class="o">/</span> <span class="s1">&#39;chunker.ci.toml&#39;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Created environment-specific configurations:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - chunker.dev.toml (development)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - chunker.prod.toml (production)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - chunker.ci.toml (CI/CD)&quot;</span><span class="p">)</span>

<span class="c1"># Usage</span>
<span class="n">configurator</span> <span class="o">=</span> <span class="n">SmartConfigurator</span><span class="p">()</span>

<span class="c1"># Generate config for current project</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">configurator</span><span class="o">.</span><span class="n">generate_config</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>

<span class="c1"># Create environment-specific configs</span>
<span class="n">configurator</span><span class="o">.</span><span class="n">create_environment_configs</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>

<span class="c1"># Use the generated config</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="n">chunk_file</span><span class="p">(</span><span class="s2">&quot;example.py&quot;</span><span class="p">,</span> <span class="s2">&quot;python&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processed with custom config: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span><span class="si">}</span><span class="s2"> chunks&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="parallel-processing-with-progress-tracking">Parallel Processing with Progress Tracking<a class="headerlink" href="#parallel-processing-with-progress-tracking" title="Permanent link">&para;</a></h3>
<p>Process large codebases efficiently with detailed progress tracking.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">chunker.chunker</span><span class="w"> </span><span class="kn">import</span> <span class="n">chunk_file</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chunker.parser</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_parser</span><span class="p">,</span> <span class="n">return_parser</span><span class="p">,</span> <span class="n">clear_cache</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">concurrent.futures</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProcessPoolExecutor</span><span class="p">,</span> <span class="n">ThreadPoolExecutor</span><span class="p">,</span> <span class="n">as_completed</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">cpu_count</span><span class="p">,</span> <span class="n">Manager</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">psutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ParallelProcessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;High-performance parallel code processor.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_workers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_processes</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_workers</span> <span class="o">=</span> <span class="n">max_workers</span> <span class="ow">or</span> <span class="n">cpu_count</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_processes</span> <span class="o">=</span> <span class="n">use_processes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;files_processed&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;chunks_found&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;errors&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;start_time&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;end_time&#39;</span><span class="p">:</span> <span class="kc">None</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;*.py&quot;</span><span class="p">,</span> 
                         <span class="n">process_func</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process all matching files in directory.&quot;&quot;&quot;</span>
        <span class="n">files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="n">file_pattern</span><span class="p">))</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s2"> files to process&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_workers</span><span class="si">}</span><span class="s2"> workers (</span><span class="si">{</span><span class="s1">&#39;processes&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">use_processes</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;threads&#39;</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># Choose executor based on configuration</span>
        <span class="n">Executor</span> <span class="o">=</span> <span class="n">ProcessPoolExecutor</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_processes</span> <span class="k">else</span> <span class="n">ThreadPoolExecutor</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="n">Executor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="c1"># Submit all tasks</span>
            <span class="n">future_to_file</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
                    <span class="n">process_func</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_file</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                <span class="p">):</span> <span class="n">file_path</span>
                <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">files</span>
            <span class="p">}</span>

            <span class="c1"># Process with progress bar</span>
            <span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Processing files&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">future_to_file</span><span class="p">):</span>
                    <span class="n">file_path</span> <span class="o">=</span> <span class="n">future_to_file</span><span class="p">[</span><span class="n">future</span><span class="p">]</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
                        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;files_processed&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;chunks_found&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;chunks_count&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

                        <span class="c1"># Update progress bar with info</span>
                        <span class="n">pbar</span><span class="o">.</span><span class="n">set_postfix</span><span class="p">({</span>
                            <span class="s1">&#39;chunks&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;chunks_found&#39;</span><span class="p">],</span>
                            <span class="s1">&#39;errors&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span>
                        <span class="p">})</span>

                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">),</span>
                            <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                            <span class="s1">&#39;chunks&#39;</span><span class="p">:</span> <span class="p">[]</span>
                        <span class="p">})</span>

                    <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;end_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print_summary</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Default file processor.&quot;&quot;&quot;</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># Detect language</span>
        <span class="n">language</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detect_language</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

        <span class="c1"># Process file</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="n">chunk_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">language</span><span class="p">)</span>

        <span class="c1"># Analyze chunks</span>
        <span class="n">analysis</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span>
            <span class="s1">&#39;language&#39;</span><span class="p">:</span> <span class="n">language</span><span class="p">,</span>
            <span class="s1">&#39;chunks_count&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">),</span>
            <span class="s1">&#39;processing_time&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">,</span>
            <span class="s1">&#39;chunks&#39;</span><span class="p">:</span> <span class="n">chunks</span><span class="p">,</span>
            <span class="s1">&#39;stats&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analyze_chunks</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">analysis</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_detect_language</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Detect language from file extension.&quot;&quot;&quot;</span>
        <span class="n">ext_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;.py&#39;</span><span class="p">:</span> <span class="s1">&#39;python&#39;</span><span class="p">,</span>
            <span class="s1">&#39;.js&#39;</span><span class="p">:</span> <span class="s1">&#39;javascript&#39;</span><span class="p">,</span>
            <span class="s1">&#39;.ts&#39;</span><span class="p">:</span> <span class="s1">&#39;javascript&#39;</span><span class="p">,</span>
            <span class="s1">&#39;.rs&#39;</span><span class="p">:</span> <span class="s1">&#39;rust&#39;</span><span class="p">,</span>
            <span class="s1">&#39;.c&#39;</span><span class="p">:</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span>
            <span class="s1">&#39;.h&#39;</span><span class="p">:</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span>
            <span class="s1">&#39;.cpp&#39;</span><span class="p">:</span> <span class="s1">&#39;cpp&#39;</span><span class="p">,</span>
            <span class="s1">&#39;.cc&#39;</span><span class="p">:</span> <span class="s1">&#39;cpp&#39;</span><span class="p">,</span>
            <span class="s1">&#39;.hpp&#39;</span><span class="p">:</span> <span class="s1">&#39;cpp&#39;</span>
        <span class="p">}</span>

        <span class="n">ext</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ext_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="s1">&#39;python&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_analyze_chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunks</span><span class="p">:</span> <span class="n">List</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyze chunks for statistics.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">chunks</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;total_lines&#39;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">end_line</span> <span class="o">-</span> <span class="n">c</span><span class="o">.</span><span class="n">start_line</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">),</span>
            <span class="s1">&#39;by_type&#39;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s1">&#39;largest_chunk&#39;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">end_line</span> <span class="o">-</span> <span class="n">c</span><span class="o">.</span><span class="n">start_line</span><span class="p">)</span><span class="o">.</span><span class="n">node_type</span><span class="p">,</span>
            <span class="s1">&#39;avg_chunk_size&#39;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">end_line</span> <span class="o">-</span> <span class="n">c</span><span class="o">.</span><span class="n">start_line</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1"># Count by type</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
            <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;by_type&#39;</span><span class="p">][</span><span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;by_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">stats</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_print_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print processing summary.&quot;&quot;&quot;</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;end_time&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">]</span>
        <span class="n">files_per_second</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;files_processed&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">duration</span> <span class="k">if</span> <span class="n">duration</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing Summary&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Files processed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;files_processed&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total chunks: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;chunks_found&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Errors: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Duration: </span><span class="si">{</span><span class="n">duration</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Speed: </span><span class="si">{</span><span class="n">files_per_second</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> files/second&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Memory usage: </span><span class="si">{</span><span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1024</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">OptimizedChunker</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Memory-efficient chunker for large files.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk_size_mb</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size_bytes</span> <span class="o">=</span> <span class="n">chunk_size_mb</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">chunk_large_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">language</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Chunk large files in parts to manage memory.&quot;&quot;&quot;</span>
        <span class="n">file_size</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span>

        <span class="k">if</span> <span class="n">file_size</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size_bytes</span><span class="p">:</span>
            <span class="c1"># Small file - process normally</span>
            <span class="k">return</span> <span class="n">chunk_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">language</span><span class="p">)</span>

        <span class="c1"># Large file - process in parts</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Large file detected (</span><span class="si">{</span><span class="n">file_size</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1024</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> MB), processing in chunks...&quot;</span><span class="p">)</span>

        <span class="n">all_chunks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">get_parser</span><span class="p">(</span><span class="n">language</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">while</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="n">file_size</span><span class="p">:</span>
                    <span class="c1"># Read chunk</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chunk_size_bytes</span><span class="p">)</span>

                    <span class="c1"># Find good break point (end of line)</span>
                    <span class="k">if</span> <span class="n">offset</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">file_size</span><span class="p">:</span>
                        <span class="n">last_newline</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">last_newline</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="n">last_newline</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

                    <span class="c1"># Parse chunk</span>
                    <span class="n">tree</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

                    <span class="c1"># Extract chunks (adjust line numbers)</span>
                    <span class="n">line_offset</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="n">offset</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">offset</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
                    <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_chunks_from_tree</span><span class="p">(</span>
                        <span class="n">tree</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">language</span><span class="p">,</span> <span class="n">line_offset</span>
                    <span class="p">)</span>
                    <span class="n">all_chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>

                    <span class="c1"># Move to next chunk</span>
                    <span class="n">offset</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="n">return_parser</span><span class="p">(</span><span class="n">language</span><span class="p">,</span> <span class="n">parser</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">all_chunks</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_chunks_from_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">language</span><span class="p">,</span> <span class="n">line_offset</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract chunks from parse tree.&quot;&quot;&quot;</span>
        <span class="c1"># This is a simplified version - real implementation would</span>
        <span class="c1"># properly walk the tree and extract chunks</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># ... chunk extraction logic ...</span>

        <span class="k">return</span> <span class="n">chunks</span>

<span class="c1"># Usage examples</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># Example 1: Parallel processing with custom function</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_complexity</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Custom processing function.&quot;&quot;&quot;</span>
        <span class="n">language</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">language_map</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;py&#39;</span><span class="p">:</span> <span class="s1">&#39;python&#39;</span><span class="p">,</span> <span class="s1">&#39;js&#39;</span><span class="p">:</span> <span class="s1">&#39;javascript&#39;</span><span class="p">,</span> <span class="s1">&#39;rs&#39;</span><span class="p">:</span> <span class="s1">&#39;rust&#39;</span><span class="p">}</span>
        <span class="n">language</span> <span class="o">=</span> <span class="n">language_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">language</span><span class="p">,</span> <span class="s1">&#39;python&#39;</span><span class="p">)</span>

        <span class="n">chunks</span> <span class="o">=</span> <span class="n">chunk_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">language</span><span class="p">)</span>

        <span class="c1"># Calculate complexity metrics</span>
        <span class="n">complexity_scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;function_definition&quot;</span><span class="p">,</span> <span class="s2">&quot;method_definition&quot;</span><span class="p">]:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">end_line</span> <span class="o">-</span> <span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="c1"># Simple complexity heuristic</span>
                <span class="n">complexity</span> <span class="o">=</span> <span class="n">lines</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;if &#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
                <span class="n">complexity_scores</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s1">&#39;complexity&#39;</span><span class="p">:</span> <span class="n">complexity</span><span class="p">,</span>
                    <span class="s1">&#39;lines&#39;</span><span class="p">:</span> <span class="n">lines</span>
                <span class="p">})</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span>
            <span class="s1">&#39;chunks&#39;</span><span class="p">:</span> <span class="n">chunks</span><span class="p">,</span>
            <span class="s1">&#39;complexity_scores&#39;</span><span class="p">:</span> <span class="n">complexity_scores</span><span class="p">,</span>
            <span class="s1">&#39;avg_complexity&#39;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;complexity&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">complexity_scores</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">complexity_scores</span><span class="p">)</span> 
                             <span class="k">if</span> <span class="n">complexity_scores</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="p">}</span>

    <span class="c1"># Run parallel processing</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">ParallelProcessor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">use_processes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_directory</span><span class="p">(</span>
        <span class="s2">&quot;./large_codebase&quot;</span><span class="p">,</span>
        <span class="n">file_pattern</span><span class="o">=</span><span class="s2">&quot;*.py&quot;</span><span class="p">,</span>
        <span class="n">process_func</span><span class="o">=</span><span class="n">analyze_complexity</span>
    <span class="p">)</span>

    <span class="c1"># Find most complex functions</span>
    <span class="n">all_complexities</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;complexity_scores&#39;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;complexity_scores&#39;</span><span class="p">]:</span>
                <span class="n">score</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span>
                <span class="n">all_complexities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>

    <span class="c1"># Sort by complexity</span>
    <span class="n">all_complexities</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;complexity&#39;</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Top 10 Most Complex Functions:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_complexities</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span> <span class="mi">1</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Complexity: </span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;complexity&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, Lines: </span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;lines&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="incremental-processing-with-change-detection">Incremental Processing with Change Detection<a class="headerlink" href="#incremental-processing-with-change-detection" title="Permanent link">&para;</a></h3>
<p>Process only changed files for efficiency.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">chunker.chunker</span><span class="w"> </span><span class="kn">import</span> <span class="n">chunk_file</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Set</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">git</span>

<span class="k">class</span><span class="w"> </span><span class="nc">IncrementalProcessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process only changed files since last run.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cache_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.chunker_cache.json&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache_file</span> <span class="o">=</span> <span class="n">cache_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_cache</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repo</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Try to initialize git repo</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span> <span class="o">=</span> <span class="n">git</span><span class="o">.</span><span class="n">Repo</span><span class="p">(</span><span class="n">search_parent_directories</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Git repository not found, using file modification times&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load processing cache.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_file</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;files&#39;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s1">&#39;last_run&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;stats&#39;</span><span class="p">:</span> <span class="p">{}</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_save_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save processing cache.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s1">&#39;last_run&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_file_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate file hash.&quot;&quot;&quot;</span>
        <span class="n">hasher</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">chunk</span> <span class="o">:=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8192</span><span class="p">):</span>
                <span class="n">hasher</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">hasher</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_changed_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;*.py&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">Path</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get files that have changed since last run.&quot;&quot;&quot;</span>
        <span class="n">changed_files</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">all_files</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="c1"># Get all matching files</span>
        <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="n">pattern</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;__pycache__&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
                <span class="n">all_files</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

        <span class="c1"># Check using git if available</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">repo</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;last_run&#39;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Get changed files since last run</span>
                <span class="n">last_run</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s1">&#39;last_run&#39;</span><span class="p">])</span>
                <span class="n">diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># Unstaged changes</span>

                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">diff</span><span class="p">:</span>
                    <span class="n">file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">working_dir</span><span class="p">)</span> <span class="o">/</span> <span class="n">item</span><span class="o">.</span><span class="n">a_path</span>
                    <span class="k">if</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">all_files</span><span class="p">:</span>
                        <span class="n">changed_files</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

                <span class="c1"># Also check committed changes</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;last_commit&#39;</span><span class="p">):</span>
                    <span class="n">commits</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">iter_commits</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s1">&#39;last_commit&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">..HEAD&quot;</span>
                    <span class="p">))</span>
                    <span class="k">for</span> <span class="n">commit</span> <span class="ow">in</span> <span class="n">commits</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">commit</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">commit</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">commit</span><span class="o">.</span><span class="n">parents</span> <span class="k">else</span> <span class="kc">None</span><span class="p">):</span>
                            <span class="n">file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">working_dir</span><span class="p">)</span> <span class="o">/</span> <span class="n">item</span><span class="o">.</span><span class="n">a_path</span>
                            <span class="k">if</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">all_files</span><span class="p">:</span>
                                <span class="n">changed_files</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

                <span class="c1"># Update last commit</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s1">&#39;last_commit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">commit</span><span class="o">.</span><span class="n">hexsha</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Git diff failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">, falling back to hash comparison&quot;</span><span class="p">)</span>
                <span class="n">changed_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_by_hash</span><span class="p">(</span><span class="n">all_files</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Fall back to hash comparison</span>
            <span class="n">changed_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_by_hash</span><span class="p">(</span><span class="n">all_files</span><span class="p">)</span>

        <span class="c1"># Check for new files</span>
        <span class="n">cached_files</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s1">&#39;files&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">new_files</span> <span class="o">=</span> <span class="n">all_files</span> <span class="o">-</span> <span class="n">cached_files</span>
        <span class="n">changed_files</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_files</span><span class="p">)</span>

        <span class="c1"># Check for deleted files</span>
        <span class="n">deleted_files</span> <span class="o">=</span> <span class="n">cached_files</span> <span class="o">-</span> <span class="n">all_files</span>
        <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">deleted_files</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s1">&#39;files&#39;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">changed_files</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_by_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Path</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">Path</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check which files changed by comparing hashes.&quot;&quot;&quot;</span>
        <span class="n">changed</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">file_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="n">current_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_file_hash</span><span class="p">(</span><span class="n">file_str</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">file_str</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s1">&#39;files&#39;</span><span class="p">]</span> <span class="ow">or</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s1">&#39;files&#39;</span><span class="p">][</span><span class="n">file_str</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hash&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">current_hash</span><span class="p">:</span>
                <span class="n">changed</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">changed</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_incrementally</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">language</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;python&quot;</span><span class="p">,</span>
                            <span class="n">force_all</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process only changed files.&quot;&quot;&quot;</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># Get changed files</span>
        <span class="k">if</span> <span class="n">force_all</span><span class="p">:</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;python&#39;</span><span class="p">:</span> <span class="s1">&#39;*.py&#39;</span><span class="p">,</span> <span class="s1">&#39;javascript&#39;</span><span class="p">:</span> <span class="s1">&#39;*.js&#39;</span><span class="p">,</span> <span class="s1">&#39;rust&#39;</span><span class="p">:</span> <span class="s1">&#39;*.rs&#39;</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">language</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span>
            <span class="n">changed_files</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="n">pattern</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">changed_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_changed_files</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">changed_files</span><span class="p">)</span><span class="si">}</span><span class="s2"> changed files&quot;</span><span class="p">)</span>

        <span class="c1"># Process changed files</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;processed_files&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;total_chunks&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;errors&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;processing_time&#39;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">changed_files</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Process file</span>
                <span class="n">chunks</span> <span class="o">=</span> <span class="n">chunk_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">),</span> <span class="n">language</span><span class="p">)</span>

                <span class="c1"># Update cache</span>
                <span class="n">file_info</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;hash&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_file_hash</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">)),</span>
                    <span class="s1">&#39;last_processed&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                    <span class="s1">&#39;chunks_count&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">),</span>
                    <span class="s1">&#39;chunk_types&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">node_type</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">))</span>
                <span class="p">}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s1">&#39;files&#39;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">)]</span> <span class="o">=</span> <span class="n">file_info</span>

                <span class="c1"># Add to results</span>
                <span class="n">results</span><span class="p">[</span><span class="s1">&#39;processed_files&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">),</span>
                    <span class="s1">&#39;chunks&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">),</span>
                    <span class="s1">&#39;types&#39;</span><span class="p">:</span> <span class="n">file_info</span><span class="p">[</span><span class="s1">&#39;chunk_types&#39;</span><span class="p">]</span>
                <span class="p">})</span>
                <span class="n">results</span><span class="p">[</span><span class="s1">&#39;total_chunks&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">),</span>
                    <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="p">})</span>

        <span class="c1"># Update statistics</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;processing_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_stats</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

        <span class="c1"># Save cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_cache</span><span class="p">()</span>

        <span class="c1"># Print summary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print_summary</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update cumulative statistics.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;cumulative&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s1">&#39;stats&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s1">&#39;stats&#39;</span><span class="p">][</span><span class="s1">&#39;cumulative&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;total_runs&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;total_files_processed&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;total_chunks_found&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;total_errors&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;total_time&#39;</span><span class="p">:</span> <span class="mi">0</span>
            <span class="p">}</span>

        <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s1">&#39;stats&#39;</span><span class="p">][</span><span class="s1">&#39;cumulative&#39;</span><span class="p">]</span>
        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;total_runs&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;total_files_processed&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;processed_files&#39;</span><span class="p">])</span>
        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;total_chunks_found&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;total_chunks&#39;</span><span class="p">]</span>
        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;total_errors&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">])</span>
        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;total_time&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;processing_time&#39;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_print_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print processing summary.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Incremental Processing Summary&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Files processed: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;processed_files&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total chunks: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;total_chunks&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Errors: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing time: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;processing_time&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Errors:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">][:</span><span class="mi">5</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">error</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">error</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Show cumulative stats</span>
        <span class="k">if</span> <span class="s1">&#39;cumulative&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s1">&#39;stats&#39;</span><span class="p">]:</span>
            <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s1">&#39;stats&#39;</span><span class="p">][</span><span class="s1">&#39;cumulative&#39;</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Cumulative Statistics:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total runs: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;total_runs&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total files processed: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;total_files_processed&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total chunks found: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;total_chunks_found&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Average files per run: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;total_files_processed&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;total_runs&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_file_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get processing history for a file.&quot;&quot;&quot;</span>
        <span class="n">file_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">file_str</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s1">&#39;files&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s1">&#39;files&#39;</span><span class="p">][</span><span class="n">file_str</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="c1"># Usage</span>
<span class="n">processor</span> <span class="o">=</span> <span class="n">IncrementalProcessor</span><span class="p">()</span>

<span class="c1"># First run - processes all files</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_incrementally</span><span class="p">(</span><span class="s2">&quot;./src&quot;</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">)</span>

<span class="c1"># Make some changes to files...</span>

<span class="c1"># Second run - only processes changed files</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_incrementally</span><span class="p">(</span><span class="s2">&quot;./src&quot;</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">)</span>

<span class="c1"># Force reprocess all files</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_incrementally</span><span class="p">(</span><span class="s2">&quot;./src&quot;</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">,</span> <span class="n">force_all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Check file history</span>
<span class="n">history</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_file_history</span><span class="p">(</span><span class="s2">&quot;./src/main.py&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">history</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Last processed: </span><span class="si">{</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;last_processed&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chunks found: </span><span class="si">{</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;chunks_count&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="language-specific-recipes">Language-Specific Recipes<a class="headerlink" href="#language-specific-recipes" title="Permanent link">&para;</a></h2>
<h3 id="python-extract-type-hints-and-decorators">Python: Extract Type Hints and Decorators<a class="headerlink" href="#python-extract-type-hints-and-decorators" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">ast</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chunker.chunker</span><span class="w"> </span><span class="kn">import</span> <span class="n">chunk_file</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PythonAnalyzer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Python-specific code analysis.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_type_hints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract and analyze type hints.&quot;&quot;&quot;</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="n">chunk_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;python&quot;</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;function_definition&quot;</span><span class="p">,</span> <span class="s2">&quot;method_definition&quot;</span><span class="p">]:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
                    <span class="n">func</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="n">analysis</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;function&#39;</span><span class="p">:</span> <span class="n">func</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="s1">&#39;parameters&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_param_types</span><span class="p">(</span><span class="n">func</span><span class="p">),</span>
                        <span class="s1">&#39;return_type&#39;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">returns</span><span class="p">)</span> <span class="k">if</span> <span class="n">func</span><span class="o">.</span><span class="n">returns</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s1">&#39;has_complete_hints&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_complete_hints</span><span class="p">(</span><span class="n">func</span><span class="p">),</span>
                        <span class="s1">&#39;decorators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">func</span><span class="o">.</span><span class="n">decorator_list</span><span class="p">]</span>
                    <span class="p">}</span>

                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">analysis</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">continue</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_param_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func_node</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract parameter type hints.&quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">func_node</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">arg</span><span class="o">.</span><span class="n">arg</span><span class="p">,</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">annotation</span><span class="p">)</span> <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">annotation</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="p">})</span>
        <span class="k">return</span> <span class="n">params</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_complete_hints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func_node</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if function has complete type hints.&quot;&quot;&quot;</span>
        <span class="c1"># Check all parameters</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">func_node</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">arg</span> <span class="o">!=</span> <span class="s1">&#39;self&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">arg</span><span class="o">.</span><span class="n">annotation</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Check return type (except for __init__)</span>
        <span class="k">if</span> <span class="n">func_node</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;__init__&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">func_node</span><span class="o">.</span><span class="n">returns</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>

<h3 id="javascripttypescript-extract-exports-and-imports">JavaScript/TypeScript: Extract Exports and Imports<a class="headerlink" href="#javascripttypescript-extract-exports-and-imports" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">chunker.chunker</span><span class="w"> </span><span class="kn">import</span> <span class="n">chunk_file</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

<span class="k">class</span><span class="w"> </span><span class="nc">JavaScriptAnalyzer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;JavaScript/TypeScript-specific analysis.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_module_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyze module imports and exports.&quot;&quot;&quot;</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="n">chunk_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;javascript&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="n">analysis</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;imports&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_imports</span><span class="p">(</span><span class="n">content</span><span class="p">),</span>
            <span class="s1">&#39;exports&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_exports</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">content</span><span class="p">),</span>
            <span class="s1">&#39;components&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_react_components</span><span class="p">(</span><span class="n">chunks</span><span class="p">),</span>
            <span class="s1">&#39;async_functions&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_async_functions</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">analysis</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_imports</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract import statements.&quot;&quot;&quot;</span>
        <span class="n">imports</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># ES6 imports</span>
        <span class="n">import_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;import\s+(?:{([^}]+)}|(\w+))\s+from\s+[&quot;</span><span class="se">\&#39;</span><span class="s1">]([^&quot;</span><span class="se">\&#39;</span><span class="s1">]+)[&quot;</span><span class="se">\&#39;</span><span class="s1">]&#39;</span>
        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">import_pattern</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
            <span class="n">imports</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;named&#39;</span> <span class="k">if</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
                <span class="s1">&#39;names&#39;</span><span class="p">:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
                <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="p">})</span>

        <span class="k">return</span> <span class="n">imports</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_exports</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunks</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract export statements.&quot;&quot;&quot;</span>
        <span class="n">exports</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;export&#39;</span> <span class="ow">in</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">exports</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span><span class="p">,</span>
                    <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span><span class="p">,</span>
                    <span class="s1">&#39;is_default&#39;</span><span class="p">:</span> <span class="s1">&#39;export default&#39;</span> <span class="ow">in</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
                    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_export_name</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
                <span class="p">})</span>

        <span class="k">return</span> <span class="n">exports</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_find_react_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunks</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find React components.&quot;&quot;&quot;</span>
        <span class="n">components</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
            <span class="c1"># Check for React component patterns</span>
            <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span> <span class="o">==</span> <span class="s2">&quot;class_declaration&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;extends Component&quot;</span> <span class="ow">in</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span> <span class="ow">or</span> <span class="s2">&quot;extends React.Component&quot;</span> <span class="ow">in</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
                    <span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span> <span class="o">==</span> <span class="s2">&quot;function_declaration&quot;</span><span class="p">:</span>
                <span class="c1"># Check for JSX return</span>
                <span class="k">if</span> <span class="s2">&quot;return &lt;&quot;</span> <span class="ow">in</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span> <span class="ow">or</span> <span class="s2">&quot;return (&quot;</span> <span class="ow">in</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
                    <span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">components</span>
</code></pre></div>

<h3 id="rust-analyze-traits-and-implementations">Rust: Analyze Traits and Implementations<a class="headerlink" href="#rust-analyze-traits-and-implementations" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">chunker.chunker</span><span class="w"> </span><span class="kn">import</span> <span class="n">chunk_file</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RustAnalyzer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Rust-specific code analysis.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_rust_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyze Rust code structure.&quot;&quot;&quot;</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="n">chunk_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;rust&quot;</span><span class="p">)</span>

        <span class="n">analysis</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;structs&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;traits&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;impls&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;functions&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;unsafe_blocks&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;lifetimes&#39;</span><span class="p">:</span> <span class="nb">set</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span> <span class="o">==</span> <span class="s2">&quot;struct_item&quot;</span><span class="p">:</span>
                <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;structs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_analyze_struct</span><span class="p">(</span><span class="n">chunk</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span> <span class="o">==</span> <span class="s2">&quot;trait_item&quot;</span><span class="p">:</span>
                <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;traits&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_analyze_trait</span><span class="p">(</span><span class="n">chunk</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span> <span class="o">==</span> <span class="s2">&quot;impl_item&quot;</span><span class="p">:</span>
                <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;impls&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_analyze_impl</span><span class="p">(</span><span class="n">chunk</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span> <span class="o">==</span> <span class="s2">&quot;function_item&quot;</span><span class="p">:</span>
                <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;functions&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_analyze_function</span><span class="p">(</span><span class="n">chunk</span><span class="p">))</span>

            <span class="c1"># Count unsafe blocks</span>
            <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;unsafe_blocks&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;unsafe {&#39;</span><span class="p">)</span>

            <span class="c1"># Extract lifetimes</span>
            <span class="n">lifetimes</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&#39;(\w+)&quot;</span><span class="p">,</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;lifetimes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">lifetimes</span><span class="p">)</span>

        <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;lifetimes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;lifetimes&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">analysis</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_analyze_struct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyze struct definition.&quot;&quot;&quot;</span>
        <span class="n">first_line</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;struct\s+(\w+)&#39;</span><span class="p">,</span> <span class="n">first_line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
            <span class="s1">&#39;is_public&#39;</span><span class="p">:</span> <span class="n">first_line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;pub &#39;</span><span class="p">),</span>
            <span class="s1">&#39;has_generics&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">in</span> <span class="n">first_line</span><span class="p">,</span>
            <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span>
        <span class="p">}</span>
</code></pre></div>

<h2 id="build-tool-integration">Build Tool Integration<a class="headerlink" href="#build-tool-integration" title="Permanent link">&para;</a></h2>
<h3 id="pre-commit-hook">Pre-commit Hook<a class="headerlink" href="#pre-commit-hook" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Pre-commit hook to check code quality using tree-sitter-chunker.</span>
<span class="sd">Save as .git/hooks/pre-commit and make executable.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chunker.chunker</span><span class="w"> </span><span class="kn">import</span> <span class="n">chunk_file</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chunker.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChunkerError</span>

<span class="c1"># Configuration</span>
<span class="n">MAX_FUNCTION_LENGTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">MAX_COMPLEXITY</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">MAX_FILE_LENGTH</span> <span class="o">=</span> <span class="mi">500</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_staged_files</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get list of staged files.&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;git&#39;</span><span class="p">,</span> <span class="s1">&#39;diff&#39;</span><span class="p">,</span> <span class="s1">&#39;--cached&#39;</span><span class="p">,</span> <span class="s1">&#39;--name-only&#39;</span><span class="p">,</span> <span class="s1">&#39;--diff-filter=ACM&#39;</span><span class="p">],</span>
        <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">text</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">check_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check a single file for issues.&quot;&quot;&quot;</span>
    <span class="n">issues</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Determine language</span>
    <span class="n">ext_map</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;.py&#39;</span><span class="p">:</span> <span class="s1">&#39;python&#39;</span><span class="p">,</span> <span class="s1">&#39;.js&#39;</span><span class="p">:</span> <span class="s1">&#39;javascript&#39;</span><span class="p">,</span> <span class="s1">&#39;.rs&#39;</span><span class="p">:</span> <span class="s1">&#39;rust&#39;</span><span class="p">}</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span>
    <span class="k">if</span> <span class="n">ext</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ext_map</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">language</span> <span class="o">=</span> <span class="n">ext_map</span><span class="p">[</span><span class="n">ext</span><span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="n">chunk_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">language</span><span class="p">)</span>

        <span class="c1"># Check function length</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">node_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;function_definition&quot;</span><span class="p">,</span> <span class="s2">&quot;method_definition&quot;</span><span class="p">]:</span>
                <span class="n">length</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">end_line</span> <span class="o">-</span> <span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="n">MAX_FUNCTION_LENGTH</span><span class="p">:</span>
                    <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span>
                        <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">start_line</span><span class="p">,</span>
                        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;long_function&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Function is </span><span class="si">{</span><span class="n">length</span><span class="si">}</span><span class="s1"> lines (max: </span><span class="si">{</span><span class="n">MAX_FUNCTION_LENGTH</span><span class="si">}</span><span class="s1">)&#39;</span>
                    <span class="p">})</span>

        <span class="c1"># Check file length</span>
        <span class="k">if</span> <span class="n">chunks</span><span class="p">:</span>
            <span class="n">total_lines</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">end_line</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">total_lines</span> <span class="o">&gt;</span> <span class="n">MAX_FILE_LENGTH</span><span class="p">:</span>
                <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span>
                    <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;long_file&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;File is </span><span class="si">{</span><span class="n">total_lines</span><span class="si">}</span><span class="s1"> lines (max: </span><span class="si">{</span><span class="n">MAX_FILE_LENGTH</span><span class="si">}</span><span class="s1">)&#39;</span>
                <span class="p">})</span>

    <span class="k">except</span> <span class="n">ChunkerError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Syntax error - let other tools handle this</span>
        <span class="k">pass</span>

    <span class="k">return</span> <span class="n">issues</span>

<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run pre-commit checks.&quot;&quot;&quot;</span>
    <span class="n">staged_files</span> <span class="o">=</span> <span class="n">get_staged_files</span><span class="p">()</span>
    <span class="n">all_issues</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">staged_files</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">issues</span> <span class="o">=</span> <span class="n">check_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="n">all_issues</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">issues</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">all_issues</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pre-commit check failed:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">issue</span> <span class="ow">in</span> <span class="n">all_issues</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">issue</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">issue</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">issue</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">issue</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Total issues: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_issues</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="mi">0</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div>

<h3 id="github-actions-workflow">GitHub Actions Workflow<a class="headerlink" href="#github-actions-workflow" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># .github/workflows/code-quality.yml</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Code Quality Check</span>

<span class="nt">on</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">push</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">pull_request</span><span class="p p-Indicator">]</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">analyze</span><span class="p">:</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>

<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set up Python</span>
<span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v4</span>
<span class="w">      </span><span class="nt">with</span><span class="p">:</span>
<span class="w">        </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.10&#39;</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
<span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">pip install uv</span>
<span class="w">        </span><span class="no">uv pip install -e .</span>
<span class="w">        </span><span class="no">uv pip install git+https://github.com/tree-sitter/py-tree-sitter.git</span>
<span class="w">        </span><span class="no">python scripts/fetch_grammars.py</span>
<span class="w">        </span><span class="no">python scripts/build_lib.py</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run code analysis</span>
<span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">python .github/scripts/analyze_code.py</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Upload results</span>
<span class="w">      </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always()</span>
<span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/upload-artifact@v3</span>
<span class="w">      </span><span class="nt">with</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">code-analysis-results</span>
<span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">code-quality-report.html</span>
<span class="w">          </span><span class="no">code-quality-report.json</span>
</code></pre></div>

<h2 id="advanced-patterns">Advanced Patterns<a class="headerlink" href="#advanced-patterns" title="Permanent link">&para;</a></h2>
<h3 id="custom-chunk-types">Custom Chunk Types<a class="headerlink" href="#custom-chunk-types" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">chunker.parser</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_parser</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CustomChunk</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extended chunk with custom attributes.&quot;&quot;&quot;</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">content</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">start_line</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">end_line</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">dependencies</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">test_coverage</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CustomChunker</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract custom chunk types.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_extractors</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;python&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;test_function&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_python_tests</span><span class="p">,</span>
                <span class="s1">&#39;dataclass&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_dataclasses</span><span class="p">,</span>
                <span class="s1">&#39;api_endpoint&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_api_endpoints</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extract_custom_chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">language</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">CustomChunk</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract custom chunk types.&quot;&quot;&quot;</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">get_parser</span><span class="p">(</span><span class="n">language</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="n">tree</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">language</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_extractors</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">chunk_type</span><span class="p">,</span> <span class="n">extractor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_extractors</span><span class="p">[</span><span class="n">language</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">chunks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">extractor</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">file_path</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">chunks</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_python_tests</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract test functions.&quot;&quot;&quot;</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Walk tree and find test functions</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">walk</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;function_definition&quot;</span><span class="p">:</span>
                <span class="n">func_content</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">start_byte</span><span class="p">:</span><span class="n">node</span><span class="o">.</span><span class="n">end_byte</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">func_content</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;def test_&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;@pytest.mark&#39;</span> <span class="ow">in</span> <span class="n">func_content</span><span class="p">:</span>
                    <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CustomChunk</span><span class="p">(</span>
                        <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;test_function&#39;</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_function_name</span><span class="p">(</span><span class="n">func_content</span><span class="p">),</span>
                        <span class="n">content</span><span class="o">=</span><span class="n">func_content</span><span class="p">,</span>
                        <span class="n">start_line</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">start_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">end_line</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">end_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">complexity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_calculate_complexity</span><span class="p">(</span><span class="n">func_content</span><span class="p">),</span>
                        <span class="n">dependencies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_extract_dependencies</span><span class="p">(</span><span class="n">func_content</span><span class="p">)</span>
                    <span class="p">))</span>

            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">walk</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

        <span class="n">walk</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">root_node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">chunks</span>
</code></pre></div>

<h2 id="see-also">See Also<a class="headerlink" href="#see-also" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="../api-reference/">API Reference</a> - Complete API documentation</li>
<li><a href="../user-guide/">User Guide</a> - Comprehensive usage guide</li>
<li><a href="../getting-started/">Getting Started</a> - Quick start tutorial</li>
<li><a href="../architecture/">Architecture</a> - System design and internals</li>
</ul>
<p>Happy coding! </p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "content.code.copy"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.50899def.min.js"></script>
      
    
  </body>
</html>